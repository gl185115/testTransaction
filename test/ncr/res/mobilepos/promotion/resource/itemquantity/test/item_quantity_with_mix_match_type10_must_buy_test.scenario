Scenario: Test Item Quantity with MixMatch Type 10 for MustBuy
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mustbuy_mixmatch.xml}
Given a loaded dataset {mixmatch_mustbuy_promotions.xml}

!-- Add A transaction
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"1001100000003","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description                        |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |1001100000003|EAN-13    |1       |0143      |Item C MixMatch Type 10 Mustbuy    |100.0                |0%      |0.0           |100.0               |100.0         |True        |

Scenario: Mustbuy Item Update (EntryID:00001, qty: 2) with 1st Step Mix Match triggered, no Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |30                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":30,"Quantity":2}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: Mustbuy Item Update (EntryID:00001, qty: 3) with 2nd Step Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Mustbuy Item ADD Update (EntryID:00001, qty: 4) with 2nd Step Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Mustbuy Item ADD Update (EntryID:00001, qty: 5) with 2nd Step Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |30                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":30,"Quantity":2}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Mustbuy Item ADD Update (EntryID:00001, qty: 6) with 2nd Step Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item ADD Update  for other item (EntryID:00001, qty: 6 | EntryID:00002, qty: 2) and 1st Step Mix Match also triggered for ItemEntry 0002, Revoke expected.
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"1001100000003","ItemIDType":"EAN-13","Quantity":1}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |13                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |27                |
|3       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |26                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |14                |
|3       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
|4       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |30                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":26,"Quantity":2},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":14,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3},{"RewardID":4,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":30,"Quantity":2}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Mustbuy Item ADD Update  for other item (EntryID:00001, qty: 6 | EntryID:00002, qty: 3) and 2nd Step Mix Match also triggered for ItemEntry 0002, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |40                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
|3       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":40,"Quantity":3},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3},{"RewardID":3,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Mustbuy Item REMOVE Update  for other item (EntryID:00001, qty: 4 | EntryID:00002, qty: 3) and 2 Mix Match triggered, Revoke is expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |40                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |40                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":40,"Quantity":3},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":40,"Quantity":3}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Mustbuy Item REMOVE Update  for other item (EntryID:00001, qty: 2 | EntryID:00002, qty: 3) and 2 Mix Match triggered, Revoke is expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |40                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |30                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":40,"Quantity":3},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":30,"Quantity":2}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Mustbuy Item REMOVE Update  for other item (EntryID:00001, qty: 1 | EntryID:00002, qty: 3) and 1 Mix Match triggered, Revoke is expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |40                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":40,"Quantity":3}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Mustbuy Item REMOVE Update  for other item (EntryID:00002, qty: 3) and 2nd step Mix Match triggered, Revoke is expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |40                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":40,"Quantity":3}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: MustBuy Item REMOVE Update  for  item (EntryID:00002, qty: 2) and 1st step  Mix Match triggered, Revoke is expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |30                |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":30,"Quantity":2}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item REMOVE Update  for  item (EntryID:00002, qty: 1) and No Mix Match triggered, Revoke is expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then there should be no Discount promotion data for update quantity.
Then the JSON should have the following format : {"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item REMOVE ALL item  for other item (No Item Entry) and No Mix Match triggered, Revoke is no more expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then there should be no Discount promotion data for update quantity.
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"2"}}}
Then there should be no Discount promotion data for update quantity.
Then the Result Code is 1110

When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"2"}}}
Then there should be no Discount promotion data for update quantity.
Then the Result Code is 1110

Scenario: Unsuccessful Discount (10 item but Not Must Buy )
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"1001100000001","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description                        |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |1001100000001|EAN-13    |1       |0143      |Item A MixMatch Type 10 Not Mustbuy|80.0                 |0%      |0.0           |80.0                |80.0          |True        |
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"9"}}}
Then there should be no Discount promotion data for update quantity.
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: Successful Discount (Add One Must Buy Item)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"1001100000003","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description                    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00002      |1001100000003|EAN-13    |1       |0143      |Item C MixMatch Type 10 Mustbuy|100.0                |0%      |0.0           |100.0               |100.0         |True        |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |15                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |25                |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1001100000003","ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"Department":"0143","Description":"Item C MixMatch Type 10 Mustbuy","RegularSalesUnitPrice":100.0,"Discount":"0%","DiscountAmount":0.0,"ActualSalesUnitPrice":100.0,"ExtendedAmount":100.0,"Discountable":true,"TaxRate":"0%","TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"InputType":0,"Line":"0143","Class":"000001"},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":15,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":25,"Quantity":2}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: Successful Discount (Three Must Buy Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"2"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |15                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |25                |
|3       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |15                |
|4       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |25                |
|5       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |15                |
|6       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |25                |
Then the JSON should have the following format : 
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":15,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":25,"Quantity":2},{"RewardID":3,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":15,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":25,"Quantity":2},{"RewardID":5,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":15,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":25,"Quantity":2}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Successful Discount (three Must Buy Item) and (three Non-Must buy item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"7"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |15                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |25                |
|3       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |28                |
|4       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |12                |
Then the JSON should have the following format : 
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":15,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":25,"Quantity":2},{"RewardID":3,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":28,"Quantity":2},{"RewardID":4,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":12,"Quantity":1}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Successful Discount (one Must Buy Item) and (three Non-Must buy item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"2"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription           |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00002      |15                |
|2       |1001          |1001         |Mix Match 1001 Type 10 Mustbuy|00001      |25                |
Then the JSON should have the following format : 
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00002","UnitDiscountAmt":15,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10 Mustbuy","ItemEntryID":"00001","UnitDiscountAmt":25,"Quantity":2}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: UnSuccessful Discount (No Must Buy Item) and (three Non-Must buy item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: UnSuccessful Discount (No Must Buy Item) and (three Non-Must buy item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: UnSuccessful Discount (No more item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: UnSuccessful Update
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then there should be no Discount promotion data for update quantity.
Then the Result Code is 1110

