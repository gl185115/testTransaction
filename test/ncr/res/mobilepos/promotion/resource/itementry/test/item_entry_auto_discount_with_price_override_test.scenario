Scenario: Test Item Entry with Automatic Discount with Tax Rate.
When the Web API Starts Up with {prm_system_config_12taxrate_roundup.xml} System Configuration
Given a Promotion Service
Given a loaded dataset {items_autodiscount_for_taxrate_12taxrate.xml}


!-- ITEM ENTRIES WITH DISCOUNT AMOUNT (WITH 12% TAX RATE) 
Scenario: Item Entry Of Price Overridden Auto Discount Amt
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"4765545775621","ItemIDType":"EAN-13","Quantity":1, "ActualSalesUnitPrice": 5000}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |4765545775621|EAN-13    |1       |0143      |Goodies      |グッズ                      |5600.0               |0.0     |0.0           |5000.0              |5000.0        |True        |0                |null      |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"4765545775621","Department":"0143","Description":{"en":"Goodies","jp":"グッズ"},"RegularSalesUnitPrice":5600.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":5000.0,"Discountable":true,"TaxRate":12,"TaxType":1,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":5600.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":5000.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When I end the transaction at promotion with retailstoreid{0031} workstationid{1111} sequencenumber{1} and transactionJson{{"Status":"0","EndDateTime":"2012-12-20T09:30:47.00"}}
Then the Result Code is 0

Scenario: Item Entry Of Price Overridden Auto Discount Amt (StoreId and TerminalId in 6 Digits)
When a Begin Transaction at promotion with parameters RetailStoreID{123456} WorkStationId{123456} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{123456} WorkStationId{123456} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"4765545775621","ItemIDType":"EAN-13","Quantity":1, "ActualSalesUnitPrice": 5000}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |4765545775621|EAN-13    |1       |0143      |Goodies      |グッズ                      |5600.0               |0.0     |0.0           |5000.0              |5000.0        |True        |0                |null      |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"4765545775621","Department":"0143","Description":{"en":"Goodies","jp":"グッズ"},"RegularSalesUnitPrice":5600.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":5000.0,"Discountable":true,"TaxRate":12,"TaxType":1,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":5600.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":5000.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When I end the transaction at promotion with retailstoreid{123456} workstationid{123456} sequencenumber{1} and transactionJson{{"Status":"0","EndDateTime":"2012-12-20T09:30:47.00"}}
Then the Result Code is 0