Scenario: Test Item Entry with MixMatch Type 4 Aliquant Case
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_aliquant_mixmatch.xml}
Given a loaded dataset {mixmatch_aliquant_promotions.xml}

!-- MMQ1 = 2;   MMP1 = 525
!-- MMQ2 = 6;   MMP2 = 1600
Scenario: Test Mix Match Aliquant for Second Step Uniformity (1st step MixMatch Occurence)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"4444444444442","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |4444444444442|EAN-13    |1       |0143      |aliquant product 2|割り切れない製品2     |546.0                |0.0     |0.0           |546.0               |546.0         |True        |1                |1         |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |207|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |114|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |171|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |94|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |93|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |150|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |82|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |82|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |82|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |135|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |74|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |74|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |74|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |76|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00006      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |119|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |65|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |65|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |65|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |65|
|6       |4014          |4014         |Mix Match Aliquant Type 4|00006      |67|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00007","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00007      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |111|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |61|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |61|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |61|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |61|
|6       |4014          |4014         |Mix Match Aliquant Type 4|00006      |61|
|7       |4014          |4014         |Mix Match Aliquant Type 4|00007      |63|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00008","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00008      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |106|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |58|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |58|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |58|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |58|
|6       |4014          |4014         |Mix Match Aliquant Type 4|00006      |58|
|7       |4014          |4014         |Mix Match Aliquant Type 4|00007      |58|
|8       |4014          |4014         |Mix Match Aliquant Type 4|00008      |58|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00009","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00009      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |101|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |55|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |55|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |55|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |55|
|6       |4014          |4014         |Mix Match Aliquant Type 4|00006      |55|
|7       |4014          |4014         |Mix Match Aliquant Type 4|00007      |55|
|8       |4014          |4014         |Mix Match Aliquant Type 4|00008      |55|
|9       |4014          |4014         |Mix Match Aliquant Type 4|00009      |59|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00010","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00010      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |97|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |53|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |53|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |53|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |53|
|6       |4014          |4014         |Mix Match Aliquant Type 4|00006      |53|
|7       |4014          |4014         |Mix Match Aliquant Type 4|00007      |53|
|8       |4014          |4014         |Mix Match Aliquant Type 4|00008      |53|
|9       |4014          |4014         |Mix Match Aliquant Type 4|00009      |53|
|10      |4014          |4014         |Mix Match Aliquant Type 4|00010      |57|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00011","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00011      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |94|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |52|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |52|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |52|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |52|
|6       |4014          |4014         |Mix Match Aliquant Type 4|00006      |52|
|7       |4014          |4014         |Mix Match Aliquant Type 4|00007      |52|
|8       |4014          |4014         |Mix Match Aliquant Type 4|00008      |52|
|9       |4014          |4014         |Mix Match Aliquant Type 4|00009      |52|
|10      |4014          |4014         |Mix Match Aliquant Type 4|00010      |52|
|11      |4014          |4014         |Mix Match Aliquant Type 4|00011      |49|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00012","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00012      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |92|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |50|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |50|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |50|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |50|
|6       |4014          |4014         |Mix Match Aliquant Type 4|00006      |50|
|7       |4014          |4014         |Mix Match Aliquant Type 4|00007      |50|
|8       |4014          |4014         |Mix Match Aliquant Type 4|00008      |50|
|9       |4014          |4014         |Mix Match Aliquant Type 4|00009      |50|
|10      |4014          |4014         |Mix Match Aliquant Type 4|00010      |50|
|11      |4014          |4014         |Mix Match Aliquant Type 4|00011      |50|
|12      |4014          |4014         |Mix Match Aliquant Type 4|00012      |54|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00013","ItemID":"4444444444441","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00013      |4444444444441|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |4014          |4014         |Mix Match Aliquant Type 4|00001      |89|
|2       |4014          |4014         |Mix Match Aliquant Type 4|00002      |49|
|3       |4014          |4014         |Mix Match Aliquant Type 4|00003      |49|
|4       |4014          |4014         |Mix Match Aliquant Type 4|00004      |49|
|5       |4014          |4014         |Mix Match Aliquant Type 4|00005      |49|
|6       |4014          |4014         |Mix Match Aliquant Type 4|00006      |49|
|7       |4014          |4014         |Mix Match Aliquant Type 4|00007      |49|
|8       |4014          |4014         |Mix Match Aliquant Type 4|00008      |49|
|9       |4014          |4014         |Mix Match Aliquant Type 4|00009      |49|
|10      |4014          |4014         |Mix Match Aliquant Type 4|00010      |49|
|11      |4014          |4014         |Mix Match Aliquant Type 4|00011      |49|
|12      |4014          |4014         |Mix Match Aliquant Type 4|00012      |49|
|13      |4014          |4014         |Mix Match Aliquant Type 4|00013      |51|
