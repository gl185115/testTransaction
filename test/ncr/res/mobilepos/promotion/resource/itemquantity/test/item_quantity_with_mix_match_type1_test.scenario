Scenario: [Bug Fixed for RES-7207] Re-adding The Same ItemEntry (With Another ItemEntry)
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}
!-- Add Item (EntryID:00001, qty: 1)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775621","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001|8865545775621|EAN-13|1|0143|sample product 1|サンプル製品1|90.0|0.0|0.0|90.0|90.0|True|0|1|
Then the Result Code is 0
!-- Add Another Item (EntryID:00001, qty: 1; EntryID:00002, qty: 1)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775621","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002|8865545775621|EAN-13|1|0143|sample product 1|サンプル製品1|90.0|0.0|0.0|90.0|90.0|True|0|1|
Then the Result Code is 0
!-- Remove first item entry (EntryID:00001, qty: 0 | EntryID:00002, qty: 1)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then there should be no promotion data.
Then the Result Code is 0
!-- Re-Add first item entry (EntryID:00001, qty: 1 | EntryID:00002, qty: 1)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775621","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001|8865545775621|EAN-13|1|0143|sample product 1|サンプル製品1|90.0|0.0|0.0|90.0|90.0|True|0|1|
Then the Result Code is 0

Scenario: [Bug Fixed for RES-7207] Re-adding The Same ItemEntry (Only Single ItemEntry)
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}
!-- Add Item (EntryID:00001, qty: 1)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775621","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001|8865545775621|EAN-13|1|0143|sample product 1|サンプル製品1|90.0|0.0|0.0|90.0|90.0|True|0|1|
Then the Result Code is 0
!-- Remove Item (EntryID:00001, qty: 0)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then there should be no promotion data.
Then the Result Code is 0
!-- Re-Add Item (EntryID:00001, qty: 1)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775621","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001|8865545775621|EAN-13|1|0143|sample product 1|サンプル製品1|90.0|0.0|0.0|90.0|90.0|True|0|1|
Then the Result Code is 0
!-- Update Quantity (EntryID:00001, qty: 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1111|1111|Mix Match 1111 Type 1|00001|20|
Then there should be no revoke
Then the Result Code is 0
!-- Remove 1 Quantity (EntryID:00001, qty: 2)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then there should be no promotion data.
Then the Result Code is 0
Then there should be revoke