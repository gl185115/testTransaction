Scenario: Test Item Quantity with MixMatch Type 6
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mustbuy_mixmatch.xml}
Given a loaded dataset {mixmatch_mustbuy_promotions.xml}

Scenario: (Integration Test) Add Items for MustBuy by rate
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775606","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|Description|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001|8865545775606|EAN-13|1|0143|sample product 606|50.0|0%|0.0|50.0|50.0|True|
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775604","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|Description|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00002|8865545775604|EAN-13|1|0143|sample product 604|100.0|0%|0.0|100.0|100.0|True|
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1006          |1006         |Mix Match 1006 Type 6|00002      |10|
|2       |1006          |1006         |Mix Match 1006 Type 6|00001      |5|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775605","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|Description|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00003|8865545775605|EAN-13|1|0143|sample product 605|80.0|0%|0.0|80.0|80.0|True|
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1006          |1006         |Mix Match 1006 Type 6|00002      |20|
|2       |1006          |1006         |Mix Match 1006 Type 6|00003      |16|
|3       |1006          |1006         |Mix Match 1006 Type 6|00001      |10|

Scenario: Item ADD Update (EntryID:00001, qty: 3) with 1st Step Mix Match triggered, no Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1006          |1006         |Mix Match 1006 Type 6|00002      |20|
|2       |1006          |1006         |Mix Match 1006 Type 6|00001      |20|
|3       |1006          |1006         |Mix Match 1006 Type 6|00003      |8|
|4       |1006          |1006         |Mix Match 1006 Type 6|00001      |5|


