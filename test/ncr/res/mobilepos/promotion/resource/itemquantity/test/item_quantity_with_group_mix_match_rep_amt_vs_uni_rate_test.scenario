Scenario: Test Item Quantity with Group MixMatch Repetition Amount VS Uniformity Rate
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}
Given a loaded dataset {group_mixmatch_promotions.xml}


Scenario: Item Entry (Normal Transaction) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}

!-- Repetition Sub-MixMatch
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"3003100000001","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description               |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |3003100000001|EAN-13    |1       |0143      |Group Mix Match Sub Item A|1000.0               |0%      |0.0           |1000.0              |1000.0        |True        |
Then there should be no promotion data.

!-- Uniformity Sub-MixMatch
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"3003200000004","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description               |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00002      |3003200000004|EAN-13    |1       |0143      |Group Mix Match Sub Item D|1900.0               |0%      |0.0           |1900.0              |1900.0        |True        |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |200               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |380               |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"3003200000004","ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"Department":"0143","Description":"Group Mix Match Sub Item D","RegularSalesUnitPrice":1900.0,"Discount":"0%","DiscountAmount":0.0,"ActualSalesUnitPrice":1900.0,"ExtendedAmount":1900.0,"Discountable":true,"TaxRate":"0%","TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"InputType":0,"Line":"0143","Class":"000001"},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":200,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":380,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: Item Update (First Item: 2, Second Item: 1)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |200               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |380               |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":200,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":380,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update (First Item: 2, Second Item: 2)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |400               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |760               |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":400,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":760,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update (First Item: 2, Second Item: 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |400               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |1140              |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":400,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":1140,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update (First Item: 5, Second Item: 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"3"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |600               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |1140              |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":600,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":1140,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update (First Item: 5, Second Item: 5)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"2"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |1000              |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |1900              |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":1000,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":1900,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update (First Item: 5, Second Item: 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"2"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |600               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |1140              |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":600,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":1140,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update (First Item: 3, Second Item: 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |600               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |1140              |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":600,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":1140,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update (First Item: 1, Second Item: 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |200               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |1140              |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":200,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":1140,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update (First Item: 0, Second Item: 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then there should be no promotion data.
Then the JSON should have the following format :
{"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update for non-existing First item (First Item: 0, Second Item: 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then there should be no Discount promotion data for update quantity.
Then the Result Code is 1110
Then there should be no revoke

Scenario: Item Update for second item (First Item: 0, Second Item: 2)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then there should be no promotion data.
Then the Result Code is 0
Then there should be no revoke

!-- Repetition Sub-MixMatch
Scenario: Added new Item  (First Item: 1, Second Item: 3)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"3003100000001","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description               |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00003      |3003100000001|EAN-13    |1       |0143      |Group Mix Match Sub Item A|1000.0               |0%      |0.0           |1000.0              |1000.0        |True        |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00002      |760               |
|2       |3003          |3003         |Group Mix Match Example 4|00003      |200               |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"3003100000001","ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"Department":"0143","Description":"Group Mix Match Sub Item A","RegularSalesUnitPrice":1000.0,"Discount":"0%","DiscountAmount":0.0,"ActualSalesUnitPrice":1000.0,"ExtendedAmount":1000.0,"Discountable":true,"TaxRate":"0%","TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"InputType":0,"Line":"0143","Class":"000001"},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":760,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00003","UnitDiscountAmt":200,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: Item Update (Third Item: 1, Second Item: 0)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"2"}}}
Then there should be no promotion data.
Then the JSON should have the following format :
{"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update for non-existing First item (Third Item: 1, Second Item: 0)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then there should be no Discount promotion data for update quantity.
Then the Result Code is 1110
Then there should be no revoke

Scenario: Item Update for Third item (Third Item: 1, Second Item: 0)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00003","Quantity":"1"}}}
Then there should be no promotion data.
Then the Result Code is 0
Then there should be no revoke
