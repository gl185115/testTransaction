Scenario: (ADD) Update Item Quantity Of Another Item Conforming 2 Steps Uniformity
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}

!-- Item Entry (EntryID:00001, Qty: 2; EntryID:00002, Qty: 2)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":2}}}
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|Description|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001|8865545775633|EAN-13|2|0143|sample product 8|150.0|0%|0.0|150.0|300.0|True|
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":2}}}
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|Description|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00002|8865545775634|EAN-13|2|0143|sample product 9|160.0|0%|0.0|160.0|320.0|True|
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |114               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00001      |106               |
Then there should be no revoke

!-- Increase Item Quantity (EntryID:00002, Qty: 1) with 2 Step Uniformity Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |171               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00001      |109               |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":171,"Quantity":3},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":109,"Quantity":2}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: (REMOVE) Update Item Quantity Conforming 1st Step of 2 Steps Uniformity - Discount Price
!-- Item Entry (EntryID:00001, Qty: 4)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":4}}}
Then Sale data should be :
|ItemEntryID|ItemID|ItemIDType|Quantity|Department|Description|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001|8865545775633|EAN-13|4|0143|sample product 8|150.0|0%|0.0|150.0|600.0|True|

!-- Decrease Item Quantity (EntryID:00001, Qty: 1) with 1st Step Uniformity Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |150               |
Then the JSON should have the following format : {"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":150,"Quantity":3}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: (REMOVE) Update Item Quantity Conforming 2nd Step of 2 Steps Uniformity - Discount Price
!-- Item Entry (EntryID:00001, Qty: 7)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":7}}}

!-- Decrease Item Quantity (EntryID:00001, Qty: 1) with 1st Step Uniformity Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |420               |
Then the JSON should have the following format : {"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":420,"Quantity":6}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: (REMOVE) Update Item Quantity Not Conforming 2 Steps Uniformity - Discount Price
!-- Item Entry (EntryID:00001, Qty: 3)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":3}}}

!-- Decrease Item Quantity (EntryID:00001, Qty: 1) with Revoke of 1st Step Uniformity Mix Match
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

!-- Decrease Item Quantity (EntryID:00001, Qty: 1) without Revoke
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Update Item Quantity With Invalid Parameters
!-- Item Entry (EntryID:00001, Qty: 1)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
When I request to update Item Quantity at promotion with parameters RetailStoreID{} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{null} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{null} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{null} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{} and TransactionJson{}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{} and TransactionJson{null}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"0"}}}
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}
!-- JSON Format Invalid "ItemEntryId" instead "ItemEntryID" 
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryId":"00001","Quantity":"0"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":133,"NCRWSSExtendedResultCode":0}
!-- Transaction Not Found
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1112} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":1102,"NCRWSSExtendedResultCode":0}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": "asdf","Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":133,"NCRWSSExtendedResultCode":0}
!-- Item entry not found
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":1110,"NCRWSSExtendedResultCode":0}
When {null} PromotionTerminalItems in the context
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag":2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then the JSON should have the following format : {"NCRWSSResultCode":133,"NCRWSSExtendedResultCode":0}