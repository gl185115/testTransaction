Scenario: Test Item Entry with Automatic Discount Data
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_autodiscount.xml}


!-- Add a single item (EntryID:00001, qty: 1)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775621","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |8865545775621|EAN-13    |1       |0143      |sample product 1|1000.0               |0%       |100.0        |900.0           |900.0         |True        |

Scenario: Item ADD Update (EntryID:00001, qty: 2) but was no Mix Match triggered
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then the  following item quantity for Sale(s) in general promotion mix match with TerminalItem{00311111}:
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |8865545775621|EAN-13    |2       |0143      |sample product 1|1000.0               |0%       |100.0        |900.0           |900.0         |True        |

Scenario: Item ADD Update (EntryID:00001, qty: 6) but was no Mix Match triggered
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"4"}}}
Then the  following item quantity for Sale(s) in general promotion mix match with TerminalItem{00311111}:
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |8865545775621|EAN-13    |6       |0143      |sample product 1|1000.0               |0%       |100.0        |900.0           |900.0         |True        |

Scenario: Add a another item (EntryID:00001, qty: 6, EntryID:00002, qty: 2)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775624","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00002      |8865545775624|EAN-13    |1       |0143      |sample product 4|687.0                |33%     |226.0         |461.0           |461.0         |True        |
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then the  following item quantity for Sale(s) in general promotion mix match with TerminalItem{00311111}:
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |8865545775621|EAN-13    |6       |0143      |sample product 1|1000.0               |0%       |100.0        |900.0           |900.0         |True        |
|00002      |8865545775624|EAN-13    |2       |0143      |sample product 4|687.0                |33%     |226.0         |461.0           |461.0         |True        |

Scenario: Item ADD Update another item Quantity (EntryID:00001, qty: 6, EntryID:00002, qty: 100)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"98"}}}
Then the  following item quantity for Sale(s) in general promotion mix match with TerminalItem{00311111}:
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |8865545775621|EAN-13    |6       |0143      |sample product 1|1000.0               |0%       |100.0        |900.0           |900.0         |True        |
|00002      |8865545775624|EAN-13    |100     |0143      |sample product 4|687.0                |33%     |226.0         |461.0           |461.0         |True        |

Scenario: Item REMOVE Update another item  Quantity (EntryID:00001, qty: 6, EntryID:00002, qty: 50)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"50"}}}
Then the  following item quantity for Sale(s) in general promotion mix match with TerminalItem{00311111}:
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |8865545775621|EAN-13    |6       |0143      |sample product 1|1000.0               |0%       |100.0        |900.0           |900.0         |True        |
|00002      |8865545775624|EAN-13    |50     |0143       |sample product 4|687.0                |33%     |226.0         |461.0           |461.0         |True        |

Scenario: Item REMOVE Update another item  Quantity (EntryID:00001, qty: 2, EntryID:00002, qty: 50)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"4"}}}
Then the  following item quantity for Sale(s) in general promotion mix match with TerminalItem{00311111}:
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |8865545775621|EAN-13    |2       |0143      |sample product 1|1000.0               |0%       |100.0        |900.0           |900.0         |True        |
|00002      |8865545775624|EAN-13    |50     |0143       |sample product 4|687.0                |33%     |226.0         |461.0           |461.0         |True        |

Scenario: REMOVE item  Quantity (EntryID:00001, qty: 2)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"50"}}}
Then the  following item quantity for Sale(s) in general promotion mix match with TerminalItem{00311111}:
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |8865545775621|EAN-13    |2       |0143      |sample product 1|1000.0               |0%       |100.0        |900.0           |900.0         |True        |


Scenario: REMOVE ALL item  Quantity (No Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"2"}}}
Then the  following item quantity for Sale(s) in general promotion mix match with TerminalItem{00311111}:
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|