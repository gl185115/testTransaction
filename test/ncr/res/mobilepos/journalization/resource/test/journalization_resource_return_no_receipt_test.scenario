Scenario: Journalization of a return without receipt transaction
Given a Journalization Resource
Given a RESMaster DBInitiator
Given MST_DEVICEINFO table
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given a corpid{111}
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 1234
Then status should be {OK}
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |1234          |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>

Scenario: Journalization of a duplicate return without receipt transaction
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given a corpid{111}
!-- first transaction poslog
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 1234
Then status should be {OK}
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |1234          |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
!-- duplicate transaction poslog
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 1234
Then status should be {OK}
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |1234          |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
!-- check if no duplicate poslog was saved
Then table {TXL_SALES_JOURNAL} will have {1} row(s)

Scenario: Journalization of two return without receipt transaction with same poslog but different txid
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given a corpid{111}
!-- first transaction poslog
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 1234
Then status should be {OK}
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |1234          |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
!-- second transaction poslog
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1235</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 1235
Then status should be {OK}
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |1234          |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
|0031         |4567         |1235          |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1235</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
!-- check if no duplicate poslog was saved
Then table {TXL_SALES_JOURNAL} will have {2} row(s)

Scenario: Retrieving of a return without receipt transaction
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given a corpid{111}
When querying transaction xml with txterminalid{4567} storeid{0031} txid{1234} 
Then result should be {OK}
Then the poslog xml should be not empty

Scenario: Journalization of a return without receipt transaction (5-digit Transaction Number)
Given a Journalization Resource
Given a RESMaster DBInitiator
Given MST_DEVICEINFO table
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>12345</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 12345
Then status should be {OK}
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |12345         |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>12345</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
