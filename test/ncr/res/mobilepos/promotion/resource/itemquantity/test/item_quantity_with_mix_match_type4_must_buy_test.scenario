Scenario: (REMOVE) Update Item Quantity Not Conforming 2 Steps Uniformity - Discount Price
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}

!-- Item Entry (EntryID:00001, Qty: 3)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":3}}}

!-- Decrease Item Quantity (EntryID:00001, Qty: 1) with Revoke of 1st Step Uniformity Mix Match
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

!-- Decrease Item Quantity (EntryID:00001, Qty: 1) without Revoke
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: (REMOVE) Update Item Quantity Conforming 1st Step of 2 Steps Uniformity - Discount Price
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}

!-- Item Entry (EntryID:00001, Qty: 4)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":4}}}

!-- Decrease Item Quantity (EntryID:00001, Qty: 1) with 1st Step Uniformity Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |150               |
Then the JSON should have the following format : {"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":150,"Quantity":3}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: (REMOVE) Update Item Quantity Conforming 2nd Step of 2 Steps Uniformity - Discount Price
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}

!-- Item Entry (EntryID:00001, Qty: 7)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":7}}}

!-- Decrease Item Quantity (EntryID:00001, Qty: 1) with 1st Step Uniformity Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |420               |
Then the JSON should have the following format : {"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":420,"Quantity":6}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: (ADD) Update Item Quantity Of Another Item Conforming 2 Steps Uniformity
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mustbuy_mixmatch.xml}
Given a loaded dataset {mixmatch_mustbuy_promotions.xml}

!-- Item Entry (EntryID:00001, Qty: 2; EntryID:00002, Qty: 2)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":2}}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":2}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |114               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00001      |106               |

!-- Increase Item Quantity (EntryID:00002, Qty: 1) with 2 Step Uniformity Mix Match triggered, Revoke expected.
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"2"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |312               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00001      |148               |
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":312,"Quantity":4},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":148,"Quantity":2}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Unsuccessful Discount (0 Must Buy Item && 9 Non Must Buy Item)
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mustbuy_mixmatch.xml}
Given a loaded dataset {mixmatch_mustbuy_promotions.xml}

When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":1}}}
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"8"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Successful Discount (1 Must Buy Item && 9 Non Must Buy Item)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |711               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |79                |
Then the JSON should have the following format : {"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"Department":"0143","Description":"sample product 8","RegularSalesUnitPrice":150.0,"Discount":"0%","DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"ExtendedAmount":150.0,"Discountable":true,"TaxRate":"0%","TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"InputType":0,"Line":"0143","Class":"000001"},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":711,"Quantity":9},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":79,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Successful Discount (2 Must Buy Item && 9 Non Must Buy Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |711               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |149                |
Then the JSON should have the following format : {"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":711,"Quantity":9},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":149,"Quantity":2}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Successful Discount (1 Must Buy Item && 9 Non Must Buy Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |711               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |79                |
Then the JSON should have the following format : {"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":711,"Quantity":9},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":79,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Successful Discount (1 Must Buy Item && 5 Non Must Buy Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"4"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |395               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |75                |
Then the JSON should have the following format : {"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":395,"Quantity":5},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":75,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Successful Discount (1 Must Buy Item && 4 Non Must Buy Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |236               |
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |54                |
Then the JSON should have the following format : {"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":236,"Quantity":4},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":54,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: UnSuccessful Discount ( 4 Non Must Buy Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: UnSuccessful Discount ( 1 Non Must Buy Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"3"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: UnSuccessful Discount ( No more Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: UnSuccessful Discount ( No more Item)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 0,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then the JSON should have the following format : {"Promotion":{"Discount":[],"NCRWSSResultCode":1110,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":1110,"NCRWSSExtendedResultCode":0}
