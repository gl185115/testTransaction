Scenario: Test Item Entry with MixMatch Type 6
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mustbuy_mixmatch.xml}
Given a loaded dataset {mixmatch_mustbuy_promotions.xml}

Scenario: (Integration Test) Add Items for MustBuy by rate
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"0001000000000","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |0001000000000|EAN-13    |1       |0143      |Item N1         |項目N1           |500.0                |0.0     |0.0           |500.0               |500.0         |True        |1                |1         |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"0002000000000","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |0002000000000|EAN-13    |1       |0143      |Item N2         |項目N2           |510.0                |0.0     |0.0           |510.0               |510.0         |True        |1                |1         |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"0003000000000","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |0003000000000|EAN-13    |1       |0143      |Item N3         |項目N3           |520.0                |0.0     |0.0           |520.0               |520.0         |True        |0                |1         |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"0004000000000","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |0004000000000|EAN-13    |1       |0143      |Item N4         |項目N4           |530.0                |0.0     |0.0           |530.0               |530.0         |True        |1                |0         |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"0005000000000","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |0005000000000|EAN-13    |1       |0143      |Item N5         |項目N5           |540.0                |0.0     |0.0           |540.0               |540.0         |True        |0                |1         |

Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1106          |1106         |Type6(Must buy)		|00005      |81|
|2       |1106          |1106         |Type6(Must buy)		|00004      |80|
|3       |1106          |1106         |Type6(Must buy)		|00003      |78|
|4       |1106          |1106         |Type6(Must buy)		|00002      |76|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"0003000000000","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00006      |0003000000000|EAN-13    |1       |0143      |Item N3         |項目N3           |520.0                |0.0     |0.0           |520.0               |520.0         |True        |0                |1         |

Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1106          |1106         |Type6(Must buy)		|00005      |81|
|2       |1106          |1106         |Type6(Must buy)		|00004      |79|
|3       |1106          |1106         |Type6(Must buy)		|00006      |78|
|4       |1106          |1106         |Type6(Must buy)		|00003      |78|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00007","ItemID":"0005000000000","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00007      |0005000000000|EAN-13    |1       |0143      |Item N5         |項目N5           |540.0                |0.0     |0.0           |540.0               |540.0         |True        |0                |1         |

Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1106          |1106         |Type6(Must buy)		|00007      |81|
|2       |1106          |1106         |Type6(Must buy)		|00004      |79|
|3       |1106          |1106         |Type6(Must buy)		|00006      |78|
|4       |1106          |1106         |Type6(Must buy)		|00003      |78|
|5       |1106          |1106         |Type6(Must buy)		|00005      |54|
|6       |1106          |1106         |Type6(Must buy)		|00002      |51|

Scenario: (Integration Test) Add Items for MustBuy by rate
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775606","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |8865545775606|EAN-13    |1       |0143      |sample product 606|サンプル製品606      |50.0                 |0.0     |0.0           |50.0                |50.0          |True        |1                |1         |
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775606","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |8865545775606|EAN-13    |1       |0143      |sample product 606|サンプル製品606      |50.0                 |0.0     |0.0           |50.0                |50.0          |True        |1                |1         |
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775606","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |8865545775606|EAN-13    |1       |0143      |sample product 606|サンプル製品606      |50.0                 |0.0     |0.0           |50.0                |50.0          |True        |1                |1         |
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"8865545775604","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |8865545775604|EAN-13    |1       |0143      |sample product 604|サンプル製品604      |100.0                |0.0     |0.0           |100.0               |100.0         |True        |1                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1006          |1006         |Mix Match 1006 Type 6|00004      |20|
|2       |1006          |1006         |Mix Match 1006 Type 6|00003      |10|
|3       |1006          |1006         |Mix Match 1006 Type 6|00002      |10|
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"8865545775605","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |8865545775605|EAN-13    |1       |0143      |sample product 605|サンプル製品605      |80.0                 |0.0     |0.0           |80.0                |80.0          |True        |0                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1006          |1006         |Mix Match 1006 Type 6|00004      |20|
|2       |1006          |1006         |Mix Match 1006 Type 6|00003      |10|
|3       |1006          |1006         |Mix Match 1006 Type 6|00002      |10|
|4       |1006          |1006         |Mix Match 1006 Type 6|00005      |8|
|5       |1006          |1006         |Mix Match 1006 Type 6|00001      |5|
