Scenario: Test Item Entry with Group MixMatch Repetition Amount VS Uniformity Rate
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}
Given a loaded dataset {group_mixmatch_promotions.xml}

Scenario: Item Entry (Normal Transaction) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"3003100000001","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |3003100000001|EAN-13    |1       |0143      |Group Mix Match Sub Item A|グループミックスマッチサブ項目A      |1000.0               |0.0     |0.0           |1000.0              |1000.0        |True        |1                |null      |
Then there should be no promotion data.

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"3003200000004","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |3003200000004|EAN-13    |1       |0143      |Group Mix Match Sub Item D|グループミックスマッチサブ項目D      |1900.0               |0.0     |0.0           |1900.0              |1900.0        |True        |1                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |200               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |380               |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"3003200000004","Department":"0143","Description":{"en":"Group Mix Match Sub Item D","jp":"グループミックスマッチサブ項目D"},"RegularSalesUnitPrice":1900.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":1900.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":1900.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":1900.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":200,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":380,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0} 
Then there should be no revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"3003100000002","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |3003100000002|EAN-13    |1       |0143      |Group Mix Match Sub Item B|グループミックスマッチサブ項目B      |900.0                |0.0     |0.0           |900.0               |900.0         |True        |1                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |200               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |380               |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"3003100000002","Department":"0143","Description":{"en":"Group Mix Match Sub Item B","jp":"グループミックスマッチサブ項目B"},"RegularSalesUnitPrice":900.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":900.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":900.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":900.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":200,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":380,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSExtendedResultCode":0,"NCRWSSResultCode":0},"NCRWSSExtendedResultCode":0,"NCRWSSResultCode":0}
Then there should be revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"3003200000003","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |3003200000003|EAN-13    |1       |0143      |Group Mix Match Sub Item C|グループミックスマッチサブ項目C      |2000.0               |0.0     |0.0           |2000.0              |2000.0        |True        |0                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |3003          |3003         |Group Mix Match Example 4|00001      |200               |
|2       |3003          |3003         |Group Mix Match Example 4|00002      |380               |
|3       |3003          |3003         |Group Mix Match Example 4|00003      |200               |
|4       |3003          |3003         |Group Mix Match Example 4|00004      |400               |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"3003200000003","Department":"0143","Description":{"en":"Group Mix Match Sub Item C","jp":"グループミックスマッチサブ項目C"},"RegularSalesUnitPrice":2000.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":2000.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"1","EmpPrice1":2000.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":2000.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00001","UnitDiscountAmt":200,"Quantity":1},{"RewardID":2,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00002","UnitDiscountAmt":380,"Quantity":1},{"RewardID":3,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00003","UnitDiscountAmt":200,"Quantity":1},{"RewardID":4,"EarnedRewardID":"3003","PromotionCode":"3003","DiscountDescription":"Group Mix Match Example 4","ItemEntryID":"00004","UnitDiscountAmt":400,"Quantity":1}],"Revoke":{"EarnedRewardID":"3003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

