Scenario: Test Item Entry with MixMatch Type 4
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mustbuy_mixmatch.xml}
Given a loaded dataset {mixmatch_mustbuy_promotions.xml}

Scenario: UnSuccessful Must Buy MixMatch (No Must Buy Items)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |8865545775634|EAN-13    |1       |0143      |sample product 9  |サンプル製品9        |160.0                |0.0     |0.0           |160.0               |160.0         |True        |0                |0         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775634","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"0","EmpPrice1":160.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":160.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775636","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |8865545775636|EAN-13    |1       |0143      |sample product 10 |サンプル製品10       |120.0                |0.0     |0.0           |120.0               |120.0         |True        |1                |1         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775636","Department":"0143","Description":{"en":"sample product 10","jp":"サンプル製品10"},"RegularSalesUnitPrice":120.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":120.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":120.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":120.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |8865545775634|EAN-13    |1       |0143      |sample product 9  |サンプル製品9        |160.0                |0.0     |0.0           |160.0               |160.0         |True        |0                |0         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775634","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"0","EmpPrice1":160.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":160.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"8865545775636","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |8865545775636|EAN-13    |1       |0143      |sample product 10 |サンプル製品10       |120.0                |0.0     |0.0           |120.0               |120.0         |True        |1                |1         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775636","Department":"0143","Description":{"en":"sample product 10","jp":"サンプル製品10"},"RegularSalesUnitPrice":120.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":120.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":120.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":120.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |8865545775634|EAN-13    |1       |0143      |sample product 9  |サンプル製品9        |160.0                |0.0     |0.0           |160.0               |160.0         |True        |0                |0         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775634","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"0","EmpPrice1":160.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00005","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":160.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"8865545775636","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00006      |8865545775636|EAN-13    |1       |0143      |sample product 10 |サンプル製品10       |120.0                |0.0     |0.0           |120.0               |120.0         |True        |1                |1         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775636","Department":"0143","Description":{"en":"sample product 10","jp":"サンプル製品10"},"RegularSalesUnitPrice":120.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":120.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":120.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00006","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":120.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Successful Must Buy MixMatch (ItemEntry using a single item)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |8865545775633|EAN-13    |1       |0143      |sample product 8  |サンプル製品8        |150.0                |0.0     |0.0           |150.0               |150.0         |True        |1                |1         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no promotion data.
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |8865545775633|EAN-13    |1       |0143      |sample product 8  |サンプル製品8        |150.0                |0.0     |0.0           |150.0               |150.0         |True        |1                |1         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no promotion data.
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |8865545775633|EAN-13    |1       |0143      |sample product 8  |サンプル製品8        |150.0                |0.0     |0.0           |150.0               |150.0         |True        |1                |1         |
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":50,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":50,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":50,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |50|
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |50|
|3       |1003          |1003         |Mix Match 1003 Type 4|00003      |50|
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":50,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":50,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":50,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":50,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |50|
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |50|
|3       |1003          |1003         |Mix Match 1003 Type 4|00003      |50|
|4       |1003          |1003         |Mix Match 1003 Type 4|00004      |50|
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00005","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":50,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":50,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":50,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":50,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":50,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |50|
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |50|
|3       |1003          |1003         |Mix Match 1003 Type 4|00003      |50|
|4       |1003          |1003         |Mix Match 1003 Type 4|00004      |50|
|5       |1003          |1003         |Mix Match 1003 Type 4|00005      |50|
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00006","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":70,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":70,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":70,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":70,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":70,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00006","UnitDiscountAmt":70,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |70|
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |70|
|3       |1003          |1003         |Mix Match 1003 Type 4|00003      |70|
|4       |1003          |1003         |Mix Match 1003 Type 4|00004      |70|
|5       |1003          |1003         |Mix Match 1003 Type 4|00005      |70|
|6       |1003          |1003         |Mix Match 1003 Type 4|00006      |70|
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00007","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00007","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":70,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":70,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":70,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":70,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":70,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00006","UnitDiscountAmt":70,"Quantity":1},{"RewardID":7,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00007","UnitDiscountAmt":70,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |70|
|2       |1003          |1003         |Mix Match 1003 Type 4|00002      |70|
|3       |1003          |1003         |Mix Match 1003 Type 4|00003      |70|
|4       |1003          |1003         |Mix Match 1003 Type 4|00004      |70|
|5       |1003          |1003         |Mix Match 1003 Type 4|00005      |70|
|6       |1003          |1003         |Mix Match 1003 Type 4|00006      |70|
|7       |1003          |1003         |Mix Match 1003 Type 4|00007      |70|

Scenario: Item Entry (full quantity Second Step) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":6}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |420|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":6,"ExtendedAmount":900.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":420,"Quantity":6}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}


Scenario: Successful Must Buy MixMatch (ItemEntry using 2 items having mustbuy flag, 2nd Item price > 1st Item price)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775637","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775637","Department":"0143","Description":{"en":"sample product 11","jp":"サンプル製品11"},"RegularSalesUnitPrice":140.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":140.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":140.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":140.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775637","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |45|
|2       |1003          |1003         |Mix Match 1003 Type 4|00001      |42|
|3       |1003          |1003         |Mix Match 1003 Type 4|00003      |43|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775637","Department":"0143","Description":{"en":"sample product 11","jp":"サンプル製品11"},"RegularSalesUnitPrice":140.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":140.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":140.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":140.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":45,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":42,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":43,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |47|
|2       |1003          |1003         |Mix Match 1003 Type 4|00004      |47|
|3       |1003          |1003         |Mix Match 1003 Type 4|00001      |43|
|4       |1003          |1003         |Mix Match 1003 Type 4|00003      |43|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":47,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":47,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":43,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":43,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"8865545775637","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |46|
|2       |1003          |1003         |Mix Match 1003 Type 4|00004      |46|
|3       |1003          |1003         |Mix Match 1003 Type 4|00001      |43|
|4       |1003          |1003         |Mix Match 1003 Type 4|00003      |43|
|5       |1003          |1003         |Mix Match 1003 Type 4|00005      |42|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775637","Department":"0143","Description":{"en":"sample product 11","jp":"サンプル製品11"},"RegularSalesUnitPrice":140.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":140.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":140.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00005","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":140.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":46,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":46,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":43,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":43,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":42,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |67|
|2       |1003          |1003         |Mix Match 1003 Type 4|00004      |67|
|3       |1003          |1003         |Mix Match 1003 Type 4|00006      |67|
|4       |1003          |1003         |Mix Match 1003 Type 4|00001      |63|
|5       |1003          |1003         |Mix Match 1003 Type 4|00003      |63|
|6       |1003          |1003         |Mix Match 1003 Type 4|00005      |63|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00006","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":67,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":67,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00006","UnitDiscountAmt":67,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":63,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":63,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":63,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00007","ItemID":"8865545775637","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00002      |67|
|2       |1003          |1003         |Mix Match 1003 Type 4|00004      |67|
|3       |1003          |1003         |Mix Match 1003 Type 4|00006      |67|
|4       |1003          |1003         |Mix Match 1003 Type 4|00001      |62|
|5       |1003          |1003         |Mix Match 1003 Type 4|00003      |62|
|6       |1003          |1003         |Mix Match 1003 Type 4|00005      |62|
|7       |1003          |1003         |Mix Match 1003 Type 4|00007      |63|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775637","Department":"0143","Description":{"en":"sample product 11","jp":"サンプル製品11"},"RegularSalesUnitPrice":140.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":140.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":140.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00007","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":140.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":67,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":67,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00006","UnitDiscountAmt":67,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":62,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":62,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":62,"Quantity":1},{"RewardID":7,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00007","UnitDiscountAmt":63,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}


Scenario: Successful Must Buy MixMatch Combination
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775634","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"0","EmpPrice1":160.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":160.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775636","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then there should be no promotion data.
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775636","Department":"0143","Description":{"en":"sample product 10","jp":"サンプル製品10"},"RegularSalesUnitPrice":120.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":120.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":120.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":120.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775637","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |46|
|2       |1003          |1003         |Mix Match 1003 Type 4|00003      |40|
|3       |1003          |1003         |Mix Match 1003 Type 4|00002      |34|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775637","Department":"0143","Description":{"en":"sample product 11","jp":"サンプル製品11"},"RegularSalesUnitPrice":140.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":140.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":140.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":140.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":46,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":40,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":34,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |48|
|2       |1003          |1003         |Mix Match 1003 Type 4|00004      |45|
|3       |1003          |1003         |Mix Match 1003 Type 4|00003      |42|
|4       |1003          |1003         |Mix Match 1003 Type 4|00002      |35|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":48,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":45,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":42,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":35,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"8865545775637","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |47|
|2       |1003          |1003         |Mix Match 1003 Type 4|00004      |44|
|3       |1003          |1003         |Mix Match 1003 Type 4|00003      |41|
|4       |1003          |1003         |Mix Match 1003 Type 4|00005      |41|
|5       |1003          |1003         |Mix Match 1003 Type 4|00002      |37|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775637","Department":"0143","Description":{"en":"sample product 11","jp":"サンプル製品11"},"RegularSalesUnitPrice":140.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":140.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":140.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00005","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":140.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":47,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":44,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":41,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":41,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":37,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |72|
|2       |1003          |1003         |Mix Match 1003 Type 4|00006      |72|
|3       |1003          |1003         |Mix Match 1003 Type 4|00004      |67|
|4       |1003          |1003         |Mix Match 1003 Type 4|00003      |63|
|5       |1003          |1003         |Mix Match 1003 Type 4|00005      |63|
|6       |1003          |1003         |Mix Match 1003 Type 4|00002      |53|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775634","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"0","EmpPrice1":160.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00006","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":160.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":72,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00006","UnitDiscountAmt":72,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":67,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":63,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":63,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":53,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00007","ItemID":"8865545775636","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1003          |1003         |Mix Match 1003 Type 4|00001      |69|
|2       |1003          |1003         |Mix Match 1003 Type 4|00006      |69|
|3       |1003          |1003         |Mix Match 1003 Type 4|00004      |65|
|4       |1003          |1003         |Mix Match 1003 Type 4|00003      |61|
|5       |1003          |1003         |Mix Match 1003 Type 4|00005      |61|
|6       |1003          |1003         |Mix Match 1003 Type 4|00002      |52|
|7       |1003          |1003         |Mix Match 1003 Type 4|00007      |53|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775636","Department":"0143","Description":{"en":"sample product 10","jp":"サンプル製品10"},"RegularSalesUnitPrice":120.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":120.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":120.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00007","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":120.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":69,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00006","UnitDiscountAmt":69,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":65,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":61,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":61,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":52,"Quantity":1},{"RewardID":7,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00007","UnitDiscountAmt":53,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
