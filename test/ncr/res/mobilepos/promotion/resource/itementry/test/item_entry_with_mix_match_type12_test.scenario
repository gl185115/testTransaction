Scenario: Test Item Entry with MixMatch Type 12
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}


Scenario: Item Entry (1 Step Unifromity Successful) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"1200000000002","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |1200000000002|EAN-13    |1       |0143      |Item A          |アイテムのA        |1980.0               |0.0     |0.0           |1980.0              |1980.0        |True        |0                |0         |
Then there should be no promotion data.

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"1200000000003","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |1200000000003|EAN-13    |1       |0143      |Item AA         |アイテムのAA       |1350.0               |0.0     |0.0           |1350.0              |1350.0        |True        |1                |1         |
Then there should be no promotion data.

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"1200000000004","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |1200000000004|EAN-13    |1       |0143      |Item G          |アイテムのG        |2000.0               |0.0     |0.0           |2000.0              |2000.0        |True        |0                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |1200          |1200         |2StepUniByAmount MM      |00003      |1062|
|2       |1200          |1200         |2StepUniByAmount MM      |00001      |1051|
|3       |1200          |1200         |2StepUniByAmount MM      |00002      |717|
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1200000000004","Department":"0143","Description":{"en":"Item G","jp":"アイテムのG"},"RegularSalesUnitPrice":2000.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":2000.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":2000.0, "OrgSalesPrice1":0.0, "PSType":"","CouponFlag":"1","ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":2000.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00003","UnitDiscountAmt":1062,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00001","UnitDiscountAmt":1051,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00002","UnitDiscountAmt":717,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: Item Entry (1 step uniformity successful)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"1200000000005","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |1200000000005|EAN-13    |1       |0143      |sample product 8|サンプル製品8      |150.0                |0.0     |0.0           |150.0               |150.0         |True        |0                |1         |
Then the Result Code is 0
Then there should be no promotion data.

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"1200000000005","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |1200000000005|EAN-13    |1       |0143      |sample product 8|サンプル製品8      |150.0                |0.0     |0.0           |150.0               |150.0         |True        |0                |1         |
Then the Result Code is 0
Then there should be no promotion data.

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"1200000000005","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |1200000000005|EAN-13    |1       |0143      |sample product 8|サンプル製品8      |150.0                |0.0     |0.0           |150.0               |150.0         |True        |0                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |2200          |2200         |2StepUniByAmount MM B|00001      |50|
|2       |2200          |2200         |2StepUniByAmount MM B|00002      |50|
|3       |2200          |2200         |2StepUniByAmount MM B|00003      |50|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1200000000005","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":150.0, "OrgSalesPrice1":0.0, "PSType":"","CouponFlag":"1","ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00001","UnitDiscountAmt":50,"Quantity":1},{"RewardID":2,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00002","UnitDiscountAmt":50,"Quantity":1},{"RewardID":3,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00003","UnitDiscountAmt":50,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry (1Step mixmatch already triggered, mix quantity)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"1200000000006","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |1200000000006|EAN-13    |2       |0143      |sample product 9|サンプル製品9      |160.0                |0.0     |0.0           |160.0               |320.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |2200          |2200         |2StepUniByAmount MM B|00004      |104|
|2       |2200          |2200         |2StepUniByAmount MM B|00001      |49|
|3       |2200          |2200         |2StepUniByAmount MM B|00002      |49|
|4       |2200          |2200         |2StepUniByAmount MM B|00003      |48|
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1200000000006","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":160.0, "OrgSalesPrice1":0.0, "PSType":"","ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":2,"ExtendedAmount":320.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00004","UnitDiscountAmt":104,"Quantity":2},{"RewardID":2,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00001","UnitDiscountAmt":49,"Quantity":1},{"RewardID":3,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00002","UnitDiscountAmt":49,"Quantity":1},{"RewardID":4,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00003","UnitDiscountAmt":48,"Quantity":1}],"Revoke":{"EarnedRewardID":"2200"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"1200000000006","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |1200000000006|EAN-13    |1       |0143      |sample product 9|サンプル製品9      |160.0                |0.0     |0.0           |160.0               |160.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |2200          |2200         |2StepUniByAmount MM B|00004      |152|
|2       |2200          |2200         |2StepUniByAmount MM B|00005      |76|
|3       |2200          |2200         |2StepUniByAmount MM B|00001      |71|
|4       |2200          |2200         |2StepUniByAmount MM B|00002      |71|
|5       |2200          |2200         |2StepUniByAmount MM B|00003      |70|
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1200000000006","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":160.0, "OrgSalesPrice1":0.0, "PSType":"","ItemEntryID":"00005","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":160.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00004","UnitDiscountAmt":152,"Quantity":2},{"RewardID":2,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00005","UnitDiscountAmt":76,"Quantity":1},{"RewardID":3,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00001","UnitDiscountAmt":71,"Quantity":1},{"RewardID":4,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00002","UnitDiscountAmt":71,"Quantity":1},{"RewardID":5,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00003","UnitDiscountAmt":70,"Quantity":1}],"Revoke":{"EarnedRewardID":"2200"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"1200000000005","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00006      |1200000000005|EAN-13    |1       |0143      |sample product 8|サンプル製品8      |150.0                |0.0     |0.0           |150.0               |150.0         |True        |0                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |2200          |2200         |2StepUniByAmount MM B|00004      |152|
|2       |2200          |2200         |2StepUniByAmount MM B|00005      |76|
|3       |2200          |2200         |2StepUniByAmount MM B|00001      |71|
|4       |2200          |2200         |2StepUniByAmount MM B|00002      |71|
|5       |2200          |2200         |2StepUniByAmount MM B|00003      |71|
|6       |2200          |2200         |2StepUniByAmount MM B|00006      |72|
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1200000000005","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":150.0, "OrgSalesPrice1":0.0, "PSType":"","CouponFlag":"1","ItemEntryID":"00006","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00004","UnitDiscountAmt":152,"Quantity":2},{"RewardID":2,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00005","UnitDiscountAmt":76,"Quantity":1},{"RewardID":3,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00001","UnitDiscountAmt":71,"Quantity":1},{"RewardID":4,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00002","UnitDiscountAmt":71,"Quantity":1},{"RewardID":5,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00003","UnitDiscountAmt":71,"Quantity":1},{"RewardID":6,"EarnedRewardID":"2200","PromotionCode":"2200","DiscountDescription":"2StepUniByAmount MM B","ItemEntryID":"00006","UnitDiscountAmt":72,"Quantity":1}],"Revoke":{"EarnedRewardID":"2200"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke
