Scenario: Test Item Entry with MixMatch Type 7
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mustbuy_mixmatch.xml}
Given a loaded dataset {mixmatch_mustbuy_promotions.xml}

Scenario: Item Entry (Single Entry With Quantity 1)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775661","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |8865545775661|EAN-13    |1       |0143      |sample product 61|サンプル製品61      |100.0                |0.0     |0.0           |100.0               |100.0         |True        |1                |1         |
Then there should be no promotion data.

!-- Add Same Item with 1 Qty
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775662","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |8865545775662|EAN-13    |1       |0143      |sample product 62|サンプル製品62      |90.0                 |0.0     |0.0           |90.0                |90.0          |True        |0                |0         |
Then there should be no promotion data.

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775663","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |8865545775663|EAN-13    |1       |0143      |sample product 63|サンプル製品63      |70.0                 |0.0     |0.0           |70.0                |70.0          |True        |1                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1008          |1008         |Mix Match 1008 Type 8|00001      |12                |
|2       |1008          |1008         |Mix Match 1008 Type 8|00002      |11                |
|3       |1008          |1008         |Mix Match 1008 Type 8|00003      |8                 |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"8865545775661","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |8865545775661|EAN-13    |1       |0143      |sample product 61|サンプル製品61      |100.0                |0.0     |0.0           |100.0               |100.0         |True        |1                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1008          |1008         |Mix Match 1008 Type 8|00001      |12                |
|2       |1008          |1008         |Mix Match 1008 Type 8|00004      |12                |
|3       |1008          |1008         |Mix Match 1008 Type 8|00002      |11                |
|4       |1008          |1008         |Mix Match 1008 Type 8|00003      |8                 |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"8865545775662","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |8865545775662|EAN-13    |1       |0143      |sample product 62|サンプル製品62      |90.0                 |0.0     |0.0           |90.0                |90.0          |True        |0                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1008          |1008         |Mix Match 1008 Type 8|00001      |12                |
|2       |1008          |1008         |Mix Match 1008 Type 8|00004      |12                |
|3       |1008          |1008         |Mix Match 1008 Type 8|00002      |11                |
|4       |1008          |1008         |Mix Match 1008 Type 8|00005      |11                |
|5       |1008          |1008         |Mix Match 1008 Type 8|00003      |8                 |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"8865545775661","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00006      |8865545775661|EAN-13    |1       |0143      |sample product 61|サンプル製品61      |100.0                |0.0     |0.0           |100.0               |100.0         |True        |1                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1008          |1008         |Mix Match 1008 Type 8|00001      |20                |
|2       |1008          |1008         |Mix Match 1008 Type 8|00004      |20                |
|3       |1008          |1008         |Mix Match 1008 Type 8|00006      |20                |
|4       |1008          |1008         |Mix Match 1008 Type 8|00002      |18                |
|5       |1008          |1008         |Mix Match 1008 Type 8|00005      |18                |
|6       |1008          |1008         |Mix Match 1008 Type 8|00003      |14                |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00007","ItemID":"8865545775662","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00007      |8865545775662|EAN-13    |1       |0143      |sample product 62|サンプル製品62      |90.0                 |0.0     |0.0           |90.0                |90.0          |True        |0                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1008          |1008         |Mix Match 1008 Type 8|00001      |20                |
|2       |1008          |1008         |Mix Match 1008 Type 8|00004      |20                |
|3       |1008          |1008         |Mix Match 1008 Type 8|00006      |20                |
|4       |1008          |1008         |Mix Match 1008 Type 8|00002      |18                |
|5       |1008          |1008         |Mix Match 1008 Type 8|00005      |18                |
|6       |1008          |1008         |Mix Match 1008 Type 8|00007      |18                |
|7       |1008          |1008         |Mix Match 1008 Type 8|00003      |14                |

Scenario: Item Entry (Single Entry With Quantity 1)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775661","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |8865545775661|EAN-13    |2       |0143      |sample product 61|サンプル製品61      |100.0                |0.0     |0.0           |100.0               |200.0         |True        |1                |1         |
Then there should be no promotion data.

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775663","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |8865545775663|EAN-13    |2       |0143      |sample product 63|サンプル製品63      |70.0                 |0.0     |0.0           |70.0                |140.0         |True        |1                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1008          |1008         |Mix Match 1008 Type 8|00001      |24                |
|2       |1008          |1008         |Mix Match 1008 Type 8|00002      |16                |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775662","ItemIDType":"EAN-13","Quantity":4}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN    |DescriptionJP    |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |8865545775662|EAN-13    |4       |0143      |sample product 62|サンプル製品62      |90.0                 |0.0     |0.0           |90.0                |360.0         |True        |0                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
|1       |1008          |1008         |Mix Match 1008 Type 8|00001      |40                |
|2       |1008          |1008         |Mix Match 1008 Type 8|00003      |72                |
|3       |1008          |1008         |Mix Match 1008 Type 8|00002      |28                |
