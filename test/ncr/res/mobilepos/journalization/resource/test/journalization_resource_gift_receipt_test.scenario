Scenario: Save GiftReceipt POSLog (Not Duplicate)
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_GIFTRECEIPT_HISTORY is empty
Given a Journalization Resource

!-- Save Sales POSLog
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction TrainingModeFlag="false"><TransactionType>Sales</TransactionType><OrganizationHierarchy Level="日本NCR01" ID="01" /><RetailStoreID>0247</RetailStoreID><WorkstationID TerminalType="1">0011</WorkstationID><SequenceNumber>7519</SequenceNumber><BusinessDayDate>2017-08-15</BusinessDayDate><BeginDateTime>2018-06-22T13:48:31</BeginDateTime><OperatorID OperatorName="責任者" OperatorNameKana="ｾｷﾆﾝｼｬｷｮｶﾌﾗｸﾞｵﾝ" OperatorGroup="1">9011011</OperatorID><ReceiptDateTime>2018-06-22T13:48:31</ReceiptDateTime><TillID>02470011</TillID><SummaryReceiptNo></SummaryReceiptNo><FloorID>01</FloorID><SummaryReceiptReservation>0</SummaryReceiptReservation><BusinessUnit Name="日本NCR　NCR茅場町店" VoucherName="日本NCR　NCR茅場町店"><Telephone><FullTelephoneNumber>03-1234-0005</FullTelephoneNumber><VoucherTelephoneNumber>03-1234-0005</VoucherTelephoneNumber></Telephone><Address> </Address></BusinessUnit><RetailTransaction OutsideSalesFlag="false"><Customer><CustomerDemographic>08</CustomerDemographic></Customer><PointsLater>0</PointsLater><Associate><AssociateID></AssociateID><AssociateName></AssociateName><AssociateKanaName></AssociateKanaName></Associate><TeamOrder>False</TeamOrder><PurSubsidy>0</PurSubsidy><AllPointExp>False</AllPointExp><ItemCount>3</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxType="0" Department="0005" Line="0005" Class="0005" ItemType="0"><UrgentEntryFlag>0</UrgentEntryFlag><ItemID Type="EAN">4055016449448</ItemID><ScanBarCode>4055016449448</ScanBarCode><Description>ミッキー100ショートスリーブグラフィックTシャツ</Description><MdKanaName>Mickey 100 Short Sleeve Graphic Tee</MdKanaName><Sku>4055016449448</Sku><SkuType></SkuType><MdVender></MdVender><SupplierCode>0325</SupplierCode><SubSupplierCode>0000</SubSupplierCode><ColorId></ColorId><ColorName></ColorName><SizeId></SizeId><SizeName></SizeName><GroupCode></GroupCode><DptNameLocal>辞書</DptNameLocal><SalesPriceFrom>0</SalesPriceFrom><OldSizeId></OldSizeId><SizePatternId1></SizePatternId1><SizePatternId2></SizePatternId2><BrandId></BrandId><BrandName></BrandName><OldSku></OldSku><RepSku></RepSku><RegularSalesUnitPrice>2000</RegularSalesUnitPrice><ActualSalesUnitPrice>2000</ActualSalesUnitPrice><ExtendedAmount>2000</ExtendedAmount><ExtendedDiscountAmount>0</ExtendedDiscountAmount><CostPrice>0</CostPrice><ItemSellingRule ItemDiscountFlag="1" TotalDiscountFlag="1" NonItemFlag="1" PointFlag="0" /><Quantity>1</Quantity><Tax TaxType="VAT"><Amount>2</Amount><Percent>0.1</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">2000</TaxableAmount></Tax><PointDiscountFlag>0</PointDiscountFlag><PointFlag>0</PointFlag><AggregateFlag>0</AggregateFlag><ItemAmount>2002</ItemAmount><CategoryCode></CategoryCode><BeforeDpt></BeforeDpt><ExceptionFlag>0</ExceptionFlag><ElectronicMoneyFlag>1</ElectronicMoneyFlag><TaxTypeSource>1</TaxTypeSource><DiscountTypeSource>2</DiscountTypeSource><Associate><AssociateID></AssociateID><AssociateName></AssociateName><AssociateKanaName></AssociateKanaName></Associate><SizeChange>False</SizeChange><SizeChanged>False</SizeChanged><PointExp>True</PointExp><DiscountExp>False</DiscountExp><GuaranteeFlag>False</GuaranteeFlag><Coupon><CouponFlag>False</CouponFlag></Coupon><RestockFlag>0</RestockFlag><MakerPrice></MakerPrice><TaxExemptFlag></TaxExemptFlag><StoreSalesPrice>2000</StoreSalesPrice></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Tender TenderType="Cash" TenderClass="1" TypeCode="Sale"><Amount>2002</Amount><TenderName>現金</TenderName><Category>0010</Category><TenderId>1</TenderId></Tender></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Tax TaxType="VAT"><Amount>2</Amount><TaxExcludeAmount>2</TaxExcludeAmount><Percent>0.1</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">2000</TaxableAmount></Tax></LineItem><Total TotalType="TransactionPurchaseQuantity">1</Total><Total TotalType="TransactionSubtotal">2000</Total><Total TotalType="TransactionGrandAmount">2002</Total></RetailTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK
Then txid should be 7519

!-- Save GiftReceipt POSLog
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction TrainingModeFlag="false"><TransactionType>GiftReceipt</TransactionType><OrganizationHierarchy Level="日本NCR01" ID="01" /><RetailStoreID>0247</RetailStoreID><WorkstationID TerminalType="1">0011</WorkstationID><SequenceNumber>7535</SequenceNumber><BusinessDayDate>2017-08-15</BusinessDayDate><BeginDateTime>2018-06-20T22:20:45</BeginDateTime><OperatorID OperatorName="緊急登録だけできる人" OperatorNameKana="ｷﾝｷｭｳﾄｳﾛｸﾀﾞｹﾃﾞｷﾙﾋﾄ" OperatorGroup="3">9</OperatorID><ReceiptDateTime>2018-06-20T22:20:45</ReceiptDateTime><TillID>02470011</TillID><SummaryReceiptNo></SummaryReceiptNo><FloorID>01</FloorID><BusinessUnit Name="日本NCR　NCR茅場町店" VoucherName="日本NCR　NCR茅場町店"><Telephone><FullTelephoneNumber>03-1234-0005</FullTelephoneNumber><VoucherTelephoneNumber>03-1234-0005</VoucherTelephoneNumber></Telephone><Address></Address></BusinessUnit><ControlTransaction Version="2.2"><ReceiptReprint TypeCode="GiftReceipt"><TransactionLink><OrganizationHierarchy Level="日本NCR01" ID="01" /><RetailStoreID>0247</RetailStoreID><WorkstationID TerminalType="1">0011</WorkstationID><SequenceNumber>7519</SequenceNumber><BusinessDayDate>2017-08-15</BusinessDayDate><TotalAmount>2002</TotalAmount></TransactionLink></ReceiptReprint></ControlTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK

!-- Re-Save GiftReceipt POSLog (Duplicate)
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction TrainingModeFlag="false"><TransactionType>GiftReceipt</TransactionType><OrganizationHierarchy Level="日本NCR01" ID="01" /><RetailStoreID>0247</RetailStoreID><WorkstationID TerminalType="1">0011</WorkstationID><SequenceNumber>7535</SequenceNumber><BusinessDayDate>2017-08-15</BusinessDayDate><BeginDateTime>2018-06-20T22:20:45</BeginDateTime><OperatorID OperatorName="緊急登録だけできる人" OperatorNameKana="ｷﾝｷｭｳﾄｳﾛｸﾀﾞｹﾃﾞｷﾙﾋﾄ" OperatorGroup="3">9</OperatorID><ReceiptDateTime>2018-06-20T22:20:45</ReceiptDateTime><TillID>02470011</TillID><SummaryReceiptNo></SummaryReceiptNo><FloorID>01</FloorID><BusinessUnit Name="日本NCR　NCR茅場町店" VoucherName="日本NCR　NCR茅場町店"><Telephone><FullTelephoneNumber>03-1234-0005</FullTelephoneNumber><VoucherTelephoneNumber>03-1234-0005</VoucherTelephoneNumber></Telephone><Address></Address></BusinessUnit><ControlTransaction Version="2.2"><ReceiptReprint TypeCode="GiftReceipt"><TransactionLink><OrganizationHierarchy Level="日本NCR01" ID="01" /><RetailStoreID>0247</RetailStoreID><WorkstationID TerminalType="1">0011</WorkstationID><SequenceNumber>7519</SequenceNumber><BusinessDayDate>2017-08-15</BusinessDayDate><TotalAmount>2002</TotalAmount></TransactionLink></ReceiptReprint></ControlTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK

!-- Get GiftReceipt Count (With GiftPrint History)
When I request to get the gift receipt printed counts for companyid:01 storeid:0247 trainingmode:0 businessdate:2017-08-15 deviceid:0011 txid:7519
Then count should be 1