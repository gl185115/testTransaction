Scenario: Testing for CreditAuthorizationResource
Given a CreditAuthorizationResource 
Then I should have a CreditAuthorizationResource

Scenario: CreditAuthorization from POS (Normal End: txid-9999)
Given a CreditAuthorizationResource
When request creditauthorization from POS
    <?xml version="1.0" encoding="shift_jis"?><CreditAuthorization><corpid>000000000000</corpid><storeid>000031</storeid><terminalid>0001</terminalid><txid>9999</txid><txdatetime>20120308165351</txdatetime><amount>440</amount><pan>3000000000000000</pan><expirationdate>1111</expirationdate></CreditAuthorization>    
Then the result should be OK

Scenario: LOCK/RELEASE external CA transaction
Given a CreditAuthorizationResource
When request to lock the transaction: txid{9999}, txdate{20120308165351}, posTermId{0001}, storeId{000031}
Then the transaction status should be locked
When request to release the transaction: txid{9999}, txdate{20120308165351}, posTermId{0001}, storeId{000031}
Then the transaction status should be released

Scenario: Manual Invoice Credit Authorization (Normal/Error End txid-8888)
Given a CreditAuthorizationResource
When I {111} use {iPod} to request request manual authorization for:
    posLogXml{<?xml version="1.0" encoding="utf-8"?><POSLog><Transaction><RetailStoreID>000031</RetailStoreID><WorkstationID>0001</WorkstationID><SequenceNumber>8888</SequenceNumber><BusinessDayDate>2012-04-25</BusinessDayDate><BeginDateTime>2012-04-25T16:53:51</BeginDateTime><OperatorID>111</OperatorID><CustomerOrderTransaction><ItemCount>1</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Tender TenderType="CreditDebit" ><Amount>440</Amount></Tender></LineItem></CustomerOrderTransaction></Transaction ></POSLog>},
    creditAuthorizationXml{<?xml version="1.0" encoding="utf-8"?><CreditAuthorization><corpid>000000000000</corpid><storeid>000031</storeid><terminalid>0001</terminalid><txid>8888</txid><txdatetime>20120425165351</txdatetime><amount>440</amount><pan>3000000000000000</pan><expirationdate>1111</expirationdate></CreditAuthorization>}
Then the Credit Authorization Response should be Status:{OK} ResultCode: {OK}
When I {111} use {iPod} to request request manual authorization for:
    posLogXml{<?xml version="1.0" encoding="utf-8"?><POSLog><Transaction><RetailStoreID>000031</RetailStoreID><WorkstationID>0001</WorkstationID><SequenceNumber>8888</SequenceNumber><BusinessDayDate>2012-04-25</BusinessDayDate><BeginDateTime>2012-04-25T16:53:51</BeginDateTime><OperatorID>111</OperatorID><CustomerOrderTransaction><ItemCount>1</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Tender TenderType="CreditDebit" ><Amount>440</Amount></Tender></LineItem></CustomerOrderTransaction></Transaction ></POSLog>},
    creditAuthorizationXml{<?xml version="1.0" encoding="utf-8"?><CreditAuthorization><corpid>000000000000</corpid><storeid>000031</storeid><terminalid>0001</terminalid><txid>8888</txid><txdatetime>20120425165351</txdatetime><amount>440</amount><pan>3000000000000000</pan><expirationdate>1111</expirationdate></CreditAuthorization>}
Then the Credit Authorization Response should be Status:{ERROR} ResultCode: {OK}


Scenario: Manual Invoice Credit Authorization (Invalid BusinessDateFormat txid-8889, BusinessDate: 2012-25-04 (should be yyyy-MM-dd format))
Given a CreditAuthorizationResource
When I {111} use {iPod} to request request manual authorization for:
    posLogXml{<?xml version="1.0" encoding="utf-8"?><POSLog><Transaction><RetailStoreID>000031</RetailStoreID><WorkstationID>0001</WorkstationID><SequenceNumber>8889</SequenceNumber><BusinessDayDate>2012-25-04</BusinessDayDate><BeginDateTime>2012-04-25T16:53:51</BeginDateTime><OperatorID>111</OperatorID><CustomerOrderTransaction><ItemCount>1</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Tender TenderType="CreditDebit" ><Amount>440</Amount></Tender></LineItem></CustomerOrderTransaction></Transaction ></POSLog>},
    creditAuthorizationXml{<?xml version="1.0" encoding="utf-8"?><CreditAuthorization><corpid>000000000000</corpid><storeid>000031</storeid><terminalid>0001</terminalid><txid>8889</txid><txdatetime>20122504165351</txdatetime><amount>440</amount><pan>3000000000000000</pan><expirationdate>1111</expirationdate></CreditAuthorization>}
Then the Credit Authorization Response should be Status:{ERROR} ResultCode: {ERROR}

Scenario: Manual Invoice Credit Authorization (Invalid POSLog xml format)
Given a CreditAuthorizationResource
When I {111} use {iPod} to request request manual authorization for:
    posLogXml{<?xml version="1.0" encoding="utf-8"?><CreditAuthorization><corpid>000000000000</corpid><storeid>000031</storeid><terminalid>0001</terminalid><txid>8889</txid><txdatetime>20122504165351</txdatetime><amount>440</amount><pan>3000000000000000</pan><expirationdate>1111</expirationdate></CreditAuthorization>},
    creditAuthorizationXml{<?xml version="1.0" encoding="utf-8"?><CreditAuthorization><corpid>000000000000</corpid><storeid>000031</storeid><terminalid>0001</terminalid><txid>8889</txid><txdatetime>20122504165351</txdatetime><amount>440</amount><pan>3000000000000000</pan><expirationdate>1111</expirationdate></CreditAuthorization>}
Then the Credit Authorization Response should be Status:{ERROR} ResultCode: {ERROR}

Scenario: ExternalCA to PastelPort (PastelPort Error - Null/Empty ApprovalCode)
Given a CreditAuthorizationResource
When pastelport reply {null} approvalcode of parameters:
    {"carddata":"GYt5MpNtqMEqS7FPMXyahnywBwMEMQA23LDB8kQNq9s69xq8gD2mrPYKqYJG2vhvcmgI9dmgur2pFobFuFywdA==","brand":"MSCREDIT","rwkind":"MSR","cashability":0,"approvedflag":0,"paymentmethod":10,"taxothers":0,"securityinfo":4,"pin":"0000","corpid":"111         ","txid":"0001","amount":"12000","paymentseq":"0001","guid":"54c31c75-63a8-470a-89ea-faf4db20c410","txdatetime":"20120604190412","service":"SUBTRACT","storeid":"000031","terminalid":"1231","txtype":"02"}, {000031}, {1111}, {20120604190401}, {0001}
Then I should get a pastelport response with resultcode equal to 205
When pastelport reply {empty} approvalcode of parameters:
    {"carddata":"GYt5MpNtqMEqS7FPMXyahnywBwMEMQA23LDB8kQNq9s69xq8gD2mrPYKqYJG2vhvcmgI9dmgur2pFobFuFywdA==","brand":"MSCREDIT","rwkind":"MSR","cashability":0,"approvedflag":0,"paymentmethod":10,"taxothers":0,"securityinfo":4,"pin":"0000","corpid":"111         ","txid":"0001","amount":"12000","paymentseq":"0001","guid":"54c31c75-63a8-470a-89ea-faf4db20c410","txdatetime":"20120604190412","service":"SUBTRACT","storeid":"000031","terminalid":"1231","txtype":"02"}, {000031}, {1111}, {20120604190401}, {0001}
Then I should get a pastelport response with resultcode equal to 205

Scenario: ExternalCA to PastelPort (Logging ErrorEnd/NormalEnd)
Given a PastelPortPortResp
When logging of external CA returns {9}
Then I should get a pastelport response with resultcode equal to 203
When logging of external CA returns {0}
Then I should get a pastelport response with resultcode equal to 0

Scenario: ExternalCA to PastelPort (Logging Fail - Status is already 1 [No Rows Updated])
Given a PastelPortPortResp
When logging of external CA for parameters:
    {"carddata":"GYt5MpNtqMEqS7FPMXyahnywBwMEMQA23LDB8kQNq9s69xq8gD2mrPYKqYJG2vhvcmgI9dmgur2pFobFuFywdA==","brand":"MSCREDIT","rwkind":"MSR","cashability":0,"approvedflag":0,"paymentmethod":10,"taxothers":0,"securityinfo":4,"pin":"0000","corpid":"111         ","txid":"0001","amount":"12000","paymentseq":"0001","guid":"54c31c75-63a8-470a-89ea-faf4db20c410","txdatetime":"20120604190412","service":"SUBTRACT","storeid":"000031","terminalid":"1231","txtype":"02"}, {000031}, {2222}, {20120604190401}, {0001}
Then I should get a pastelport response with resultcode equal to 203

Scenario: ExternalCA to PastelPort (Logging Success - Status Set to 1 [Row Updated])
Given a PastelPortPortResp
When logging of external CA for parameters:
    {"carddata":"GYt5MpNtqMEqS7FPMXyahnywBwMEMQA23LDB8kQNq9s69xq8gD2mrPYKqYJG2vhvcmgI9dmgur2pFobFuFywdA==","brand":"MSCREDIT","rwkind":"MSR","cashability":0,"approvedflag":0,"paymentmethod":10,"taxothers":0,"securityinfo":4,"pin":"0000","corpid":"111         ","txid":"0001","amount":"12000","paymentseq":"0001","guid":"54c31c75-63a8-470a-89ea-faf4db20c410","txdatetime":"20120604190412","service":"SUBTRACT","storeid":"000031","terminalid":"1231","txtype":"02"}, {000031}, {1111}, {20120604190401}, {0001}
Then I should get a pastelport response with resultcode equal to 0

Scenario: Manual Entry of ExternalCA to PastelPort (PastelPort Error - Null/Empty ApprovalCode)
Given a CreditAuthorizationResource
When pastelport reply {null} approvalcode for manual entry
Then I should get a pastelport response with resultcode equal to 205
When pastelport reply {empty} approvalcode for manual entry
Then I should get a pastelport response with resultcode equal to 205

Scenario: Manual Entry of ExternalCA to PastelPort (Uploading - Normal End )
Given a PastelPortPortResp
When uploading of external CA for parameters:
    {"carddata":"GYt5MpNtqMEqS7FPMXyahnywBwMEMQA23LDB8kQNq9s69xq8gD2mrPYKqYJG2vhvcmgI9dmgur2pFobFuFywdA==","brand":"MSCREDIT","rwkind":"MSR","cashability":0,"approvedflag":0,"paymentmethod":10,"taxothers":0,"securityinfo":4,"pin":"0000","corpid":"111         ","txid":"0001","amount":"12000","paymentseq":"0001","guid":"54c31c75-63a8-470a-89ea-faf4db20c410","txdatetime":"20120604190412","service":"SUBTRACT","storeid":"000031","terminalid":"1231","txtype":"02"}, {000031}, {3333}, {20120604190401}, {0001}, {111}
Then I should get a pastelport response with resultcode equal to 0

Scenario: Manual Entry of ExternalCA to PastelPort (Uploading - Normal End [Duplicate Entry])
Given a PastelPortPortResp
When uploading of external CA for parameters:
    {"carddata":"GYt5MpNtqMEqS7FPMXyahnywBwMEMQA23LDB8kQNq9s69xq8gD2mrPYKqYJG2vhvcmgI9dmgur2pFobFuFywdA==","brand":"MSCREDIT","rwkind":"MSR","cashability":0,"approvedflag":0,"paymentmethod":10,"taxothers":0,"securityinfo":4,"pin":"0000","corpid":"111         ","txid":"0001","amount":"12000","paymentseq":"0001","guid":"54c31c75-63a8-470a-89ea-faf4db20c410","txdatetime":"20120604190412","service":"SUBTRACT","storeid":"000031","terminalid":"1231","txtype":"02"}, {000031}, {3333}, {20120604190401}, {0001}, {111}
Then I should get a pastelport response with resultcode equal to 0