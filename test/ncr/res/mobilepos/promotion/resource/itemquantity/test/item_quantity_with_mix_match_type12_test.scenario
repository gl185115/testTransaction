Scenario: Test Item Quantity with MixMatch Type 12
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}

!-- MMQ1 = 3   MMP1 = 2830
!-- MMQ2 = 6   MMP2 = 3000
!-- Add a Transaction
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"1200000000002","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00001      |1200000000002|EAN-13    |1       |0143      |Item A     |1980.0               |0%      |0.0           |1980.0              |1980.0        |True|
Then there should be no promotion data.

Scenario: Item Update(1stItem = 2)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription  |ItemEntryID|UnitDiscountAmount|
Then there should be no revoke

Scenario: Item Update(1stItem = 3)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |1200          |1200         |2StepUniByAmount MM      |00001      |2830|
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00001","UnitDiscountAmt":2830,"Quantity":3}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: Item Update(1stItem = 4)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |1200          |1200         |2StepUniByAmount MM      |00001      |3773|
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00001","UnitDiscountAmt":3773,"Quantity":4}],"Revoke":{"EarnedRewardID":"1200"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update(1stItem = 5)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |1200          |1200         |2StepUniByAmount MM      |00001      |4716|
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00001","UnitDiscountAmt":4716,"Quantity":5}],"Revoke":{"EarnedRewardID":"1200"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update(1stItem = 6)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |1200          |1200         |2StepUniByAmount MM      |00001      |3000|
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00001","UnitDiscountAmt":3000,"Quantity":6}],"Revoke":{"EarnedRewardID":"1200"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update(1stItem = 11)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"5"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |1200          |1200         |2StepUniByAmount MM      |00001      |5500|
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00001","UnitDiscountAmt":5500,"Quantity":11}],"Revoke":{"EarnedRewardID":"1200"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Item Update(1stItem = 12)
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00001","Quantity":"1"}}}
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |1200          |1200         |2StepUniByAmount MM      |00001      |6000|
Then the JSON should have the following format :
{"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1200","PromotionCode":"1200","DiscountDescription":"2StepUniByAmount MM","ItemEntryID":"00001","UnitDiscountAmt":6000,"Quantity":12}],"Revoke":{"EarnedRewardID":"1200"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

Scenario: Add Another Item(1stItem = 12 and 2ndItem = 1)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"1200000000004","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|Description|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|
|00002      |1200000000004|EAN-13    |1       |0143      |Item G     |2000.0               |0%      |0.0           |2000.0              |2000.0        |True|
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription      |ItemEntryID|UnitDiscountAmount|
|1       |1200          |1200         |2StepUniByAmount MM      |00002      |505|
|2       |1200          |1200         |2StepUniByAmount MM      |00001      |5995|
Then there should be revoke
