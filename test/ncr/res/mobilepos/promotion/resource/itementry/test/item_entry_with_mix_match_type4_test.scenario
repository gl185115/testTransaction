Scenario: Test Item Entry with MixMatch Type 4
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}

Scenario: Item Entry (1 Step successful) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"1111111111121","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |1111111111121|EAN-13    |1       |0143      |Item A       |アイテムのA     |1980.0               |0.0     |0.0           |1980.0              |1980.0        |True        |1                |1         |
Then there should be no promotion data.
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"1111111111122","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |1111111111122|EAN-13    |1       |0143      |Item AA      |アイテムのAA    |1350.0               |0.0     |0.0           |1350.0              |1350.0        |True        |1                |0         |
Then there should be no promotion data.
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"1111111111123","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |1111111111123|EAN-13    |1       |0143      |Item G       |アイテムのG     |2000.0               |0.0     |0.0           |2000.0              |2000.0        |True        |1                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|9886|9886|Proportion Distribution 4|00003|1062|
|2|9886|9886|Proportion Distribution 4|00001|1051|
|3|9886|9886|Proportion Distribution 4|00002|717|
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1111111111123","Department":"0143","Description":{"en":"Item G","jp":"アイテムのG"},"RegularSalesUnitPrice":2000.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":2000.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":2000.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":2000.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"9886","PromotionCode":"9886","DiscountDescription":"Proportion Distribution 4","ItemEntryID":"00003","UnitDiscountAmt":1062,"Quantity":1},{"RewardID":2,"EarnedRewardID":"9886","PromotionCode":"9886","DiscountDescription":"Proportion Distribution 4","ItemEntryID":"00001","UnitDiscountAmt":1051,"Quantity":1},{"RewardID":3,"EarnedRewardID":"9886","PromotionCode":"9886","DiscountDescription":"Proportion Distribution 4","ItemEntryID":"00002","UnitDiscountAmt":717,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

Scenario: Item Entry (same items, different item entry id) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00001|50|
|2|1003|1003|Mix Match 1003 Type 4|00002|50|
|3|1003|1003|Mix Match 1003 Type 4|00003|50|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":50,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":50,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":50,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry (mixmatch already triggered, mix quantity)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |8865545775634|EAN-13    |2       |0143      |sample product 9|サンプル製品9      |160.0                |0.0     |0.0           |160.0               |320.0         |True        |1                |1         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00004|112|
|2|1003|1003|Mix Match 1003 Type 4|00001|53|
|3|1003|1003|Mix Match 1003 Type 4|00002|53|
|4|1003|1003|Mix Match 1003 Type 4|00003|52|
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775634","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":160.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":2,"ExtendedAmount":320.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":112,"Quantity":2},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":53,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":53,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":52,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN   |DescriptionJP   |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |8865545775633|EAN-13    |1       |0143      |sample product 8|サンプル製品8      |150.0                |0.0     |0.0           |150.0               |150.0         |True        |1                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00004|154|
|2|1003|1003|Mix Match 1003 Type 4|00001|72|
|3|1003|1003|Mix Match 1003 Type 4|00002|72|
|4|1003|1003|Mix Match 1003 Type 4|00003|72|
|5|1003|1003|Mix Match 1003 Type 4|00005|70|
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00005","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":150.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":154,"Quantity":2},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":72,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":72,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":72,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":70,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"8865545775634","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00004|154|
|2|1003|1003|Mix Match 1003 Type 4|00006|154|
|3|1003|1003|Mix Match 1003 Type 4|00001|73|
|4|1003|1003|Mix Match 1003 Type 4|00002|73|
|5|1003|1003|Mix Match 1003 Type 4|00003|73|
|6|1003|1003|Mix Match 1003 Type 4|00005|73|
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775634","Department":"0143","Description":{"en":"sample product 9","jp":"サンプル製品9"},"RegularSalesUnitPrice":160.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":160.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":160.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00006","ItemIDType":"EAN-13","Quantity":2,"ExtendedAmount":320.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00004","UnitDiscountAmt":154,"Quantity":2},{"RewardID":2,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00006","UnitDiscountAmt":154,"Quantity":2},{"RewardID":3,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":73,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00002","UnitDiscountAmt":73,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00003","UnitDiscountAmt":73,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00005","UnitDiscountAmt":73,"Quantity":1}],"Revoke":{"EarnedRewardID":"1003"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke


Scenario: Item Entry (full quantity of 2nd step) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":6}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00001|420|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":6,"ExtendedAmount":900.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":420,"Quantity":6}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry (full quantity of 2nd step) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":6}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00001|420|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":6,"ExtendedAmount":900.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":420,"Quantity":6}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00001|420|
|2|1003|1003|Mix Match 1003 Type 4|00002|140|

Scenario: Item Entry (full quantity of 2nd step) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":8}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00001|560|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":8,"ExtendedAmount":1200.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":560,"Quantity":8}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry (full quantity of 2nd step) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":3}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00001|150|
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"8865545775633","Department":"0143","Description":{"en":"sample product 8","jp":"サンプル製品8"},"RegularSalesUnitPrice":150.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":150.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"0","EmpPrice1":150.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":3,"ExtendedAmount":450.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1003","PromotionCode":"1003","DiscountDescription":"Mix Match 1003 Type 4","ItemEntryID":"00001","UnitDiscountAmt":150,"Quantity":3}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775633","ItemIDType":"EAN-13","Quantity":5}}}
Then the Result Code is 0
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match 1003 Type 4|00001|210|
|2|1003|1003|Mix Match 1003 Type 4|00002|350|
Then there should be revoke

Scenario: Integration Test (MixMatch 1 Step Uniformity/RES3.1-703 until RES3.1-714)
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"8865545775732","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |8865545775732|EAN-13    |1       |0143      |sample product 3.2|サンプル製品3.2      |100.0                |0.0     |0.0           |100.0               |100.0         |True        |0                |1         |
Then there should be no promotion data.
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"8865545775733","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |8865545775733|EAN-13    |1       |0143      |sample product 3.3|サンプル製品3.3      |90.0                 |0.0     |0.0           |90.0                |90.0          |True        |0                |1         |
When I request to update Item Quantity at promotion with parameters RetailStoreID{0031} WorkStationID{1111} SequenceNo{1} and TransactionJson{{"EntryFlag": 2,"Sale":{"ItemEntryID":"00002","Quantity":"1"}}}
Then promotion should have the following data for update quantity:
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1012|1012|Mix Match 1002 Type 3B|00001|14|
|2|1012|1012|Mix Match 1002 Type 3B|00002|26|