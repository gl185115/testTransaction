Scenario: Test Item Entry with MixMatch Type 10
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_mixmatch.xml}
Given a loaded dataset {mixmatch_promotions.xml}

Scenario: Item Entry (same items, different item entry id, 1st step discount) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"1000000001001","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |1000000001001|EAN-13    |1       |0143      |Type 10 MixMatch Product 1|タイプ10 MixMatch製品1       |100.0                |0.0     |0.0           |100.0               |100.0         |True        |0                |0         |
Then there should be no promotion data.

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"1000000001002","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |1000000001002|EAN-13    |1       |0143      |Type 10 MixMatch Product 2|タイプ10 MixMatch製品2       |100.0                |0.0     |0.0           |100.0               |100.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription   |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10|00002      |15                |
|2       |1001          |1001         |Mix Match 1001 Type 10|00001      |15                |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1000000001002","Department":"0143","Description":{"en":"Type 10 MixMatch Product 2","jp":"タイプ10 MixMatch製品2"},"RegularSalesUnitPrice":100.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":100.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":100.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00002","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":100.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00002","UnitDiscountAmt":15,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00001","UnitDiscountAmt":15,"Quantity":1}],"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be no revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"1000000001002","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |1000000001002|EAN-13    |1       |0143      |Type 10 MixMatch Product 2|タイプ10 MixMatch製品2       |100.0                |0.0     |0.0           |100.0               |100.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription   |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10|00003      |13                |
|2       |1001          |1001         |Mix Match 1001 Type 10|00002      |13                |
|3       |1001          |1001         |Mix Match 1001 Type 10|00001      |14                |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1000000001002","Department":"0143","Description":{"en":"Type 10 MixMatch Product 2","jp":"タイプ10 MixMatch製品2"},"RegularSalesUnitPrice":100.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":100.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":100.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":100.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00003","UnitDiscountAmt":13,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00002","UnitDiscountAmt":13,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00001","UnitDiscountAmt":14,"Quantity":1}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"1000000001001","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |1000000001001|EAN-13    |1       |0143      |Type 10 MixMatch Product 1|タイプ10 MixMatch製品1       |100.0                |0.0     |0.0           |100.0               |100.0         |True        |0                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription   |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10|00004      |13                |
|2       |1001          |1001         |Mix Match 1001 Type 10|00003      |13                |
|3       |1001          |1001         |Mix Match 1001 Type 10|00002      |14                |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1000000001001","Department":"0143","Description":{"en":"Type 10 MixMatch Product 1","jp":"タイプ10 MixMatch製品1"},"RegularSalesUnitPrice":100.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":100.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"0","EmpPrice1":100.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":100.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00004","UnitDiscountAmt":13,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00003","UnitDiscountAmt":13,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00002","UnitDiscountAmt":14,"Quantity":1}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"1000000001002","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |1000000001002|EAN-13    |1       |0143      |Type 10 MixMatch Product 2|タイプ10 MixMatch製品2       |100.0                |0.0     |0.0           |100.0               |100.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription   |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10|00005      |13                |
|2       |1001          |1001         |Mix Match 1001 Type 10|00004      |13                |
|3       |1001          |1001         |Mix Match 1001 Type 10|00003      |14                |
|4       |1001          |1001         |Mix Match 1001 Type 10|00002      |15                |
|5       |1001          |1001         |Mix Match 1001 Type 10|00001      |15                |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1000000001002","Department":"0143","Description":{"en":"Type 10 MixMatch Product 2","jp":"タイプ10 MixMatch製品2"},"RegularSalesUnitPrice":100.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":100.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":100.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00005","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":100.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00005","UnitDiscountAmt":13,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00004","UnitDiscountAmt":13,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00003","UnitDiscountAmt":14,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00002","UnitDiscountAmt":15,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00001","UnitDiscountAmt":15,"Quantity":1}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"1000000001002","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN             |DescriptionJP             |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00006      |1000000001002|EAN-13    |1       |0143      |Type 10 MixMatch Product 2|タイプ10 MixMatch製品2       |100.0                |0.0     |0.0           |100.0               |100.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription   |ItemEntryID|UnitDiscountAmount|
|1       |1001          |1001         |Mix Match 1001 Type 10|00006      |13                |
|2       |1001          |1001         |Mix Match 1001 Type 10|00005      |13                |
|3       |1001          |1001         |Mix Match 1001 Type 10|00004      |14                |
|4       |1001          |1001         |Mix Match 1001 Type 10|00003      |13                |
|5       |1001          |1001         |Mix Match 1001 Type 10|00002      |13                |
|6       |1001          |1001         |Mix Match 1001 Type 10|00001      |14                |
Then the JSON should have the following format :
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"1000000001002","Department":"0143","Description":{"en":"Type 10 MixMatch Product 2","jp":"タイプ10 MixMatch製品2"},"RegularSalesUnitPrice":100.0,"Discount":0.0,"DiscountFlag":0,"DiscountAmount":0.0,"ActualSalesUnitPrice":100.0,"Discountable":true,"TaxRate":0,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"EmpPrice1":100.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00006","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":100.0,"InputType":0},"EntryFlag":0},"Promotion":{"Discount":[{"RewardID":1,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00006","UnitDiscountAmt":13,"Quantity":1},{"RewardID":2,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00005","UnitDiscountAmt":13,"Quantity":1},{"RewardID":3,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00004","UnitDiscountAmt":14,"Quantity":1},{"RewardID":4,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00003","UnitDiscountAmt":13,"Quantity":1},{"RewardID":5,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00002","UnitDiscountAmt":13,"Quantity":1},{"RewardID":6,"EarnedRewardID":"1001","PromotionCode":"1001","DiscountDescription":"Mix Match 1001 Type 10","ItemEntryID":"00001","UnitDiscountAmt":14,"Quantity":1}],"Revoke":{"EarnedRewardID":"1001"},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then there should be revoke