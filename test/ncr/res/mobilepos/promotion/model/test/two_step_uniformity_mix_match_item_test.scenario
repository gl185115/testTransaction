Scenario: Test SecondStepUniformityMixMatchItem
Given a MixMatchData of the following:
|MMCode|MMQ|MMP|MMDescription|MMQ2|MMP2
|0002  |3  |120|Discount100x3|6   |180

!-- SINGLE ENTRIES (One Item_Entry)
!-- 1ST Entry [Add entry with 1 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemA |50   |1  |0001       |
When I compute discount of 2ndStepUniformity
Then I should get {0} discounts

!-- 2ND Entry [Add entry with 1 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |50   |1  |0002       |
When I compute discount of 2ndStepUniformity
Then I should get {0} discounts

!-- 3RD Entry [Add entry with 1 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |50   |1  |0003       |
When I compute discount of 2ndStepUniformity
Then I should get {3} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0001       |10             |
|2       |0002          |0002         |Discount100x3  |0002       |10             |
|3       |0002          |0002         |Discount100x3  |0003       |10             |

!-- 4TH Entry [Add entry with 1 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |50   |1  |0004       |
When I compute discount of 2ndStepUniformity
Then I should get {4} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0001       |10             |
|2       |0002          |0002         |Discount100x3  |0002       |10             |
|3       |0002          |0002         |Discount100x3  |0003       |10             |
|4       |0002          |0002         |Discount100x3  |0004       |10             |

!-- 5TH Entry [Add entry with 3 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |90   |3  |0005       |
When I compute discount of 2ndStepUniformity
Then I should get {7} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0005       |50             |
|1       |0002          |0002         |Discount100x3  |0005       |50             |
|1       |0002          |0002         |Discount100x3  |0005       |50             |
|2       |0002          |0002         |Discount100x3  |0001       |28             |
|3       |0002          |0002         |Discount100x3  |0002       |28             |
|4       |0002          |0002         |Discount100x3  |0003       |28             |
|5       |0002          |0002         |Discount100x3  |0004       |26             |


!-- 6TH Entry [Add entry with 4 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |35   |4  |0006       |
When I compute discount of 2ndStepUniformity
Then I should get {11} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0005       |41             |
|1       |0002          |0002         |Discount100x3  |0005       |41             |
|1       |0002          |0002         |Discount100x3  |0005       |41             |
|2       |0002          |0002         |Discount100x3  |0001       |23             |
|3       |0002          |0002         |Discount100x3  |0002       |23             |
|4       |0002          |0002         |Discount100x3  |0003       |23             |
|5       |0002          |0002         |Discount100x3  |0004       |23             |
|6       |0002          |0002         |Discount100x3  |0006       |16             |
|6       |0002          |0002         |Discount100x3  |0006       |16             |
|6       |0002          |0002         |Discount100x3  |0006       |16             |
|6       |0002          |0002         |Discount100x3  |0006       |17             |

Scenario: Test SecondStepUniformityMixMatchItem (1st Entry is Bundle)
Given a MixMatchData of the following:
|MMCode|MMQ|MMP|MMDescription|MMQ2|MMP2|
|0002  |3  |120|Discount100x3|6   |180 |

!-- 1ST Entry [Add entry with different quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemA |50   |3  |0001       |
|ItemA |60   |2  |0002       |
|ItemA |70   |1  |0003       |
When I compute discount of 2ndStepUniformity
Then I should get {6} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0003       |33             |
|2       |0002          |0002         |Discount100x3  |0002       |28             |
|2       |0002          |0002         |Discount100x3  |0002       |28             |
|3       |0002          |0002         |Discount100x3  |0001       |24             |
|3       |0002          |0002         |Discount100x3  |0001       |24             |
|3       |0002          |0002         |Discount100x3  |0001       |23             |


Scenario: Test SecondStepUniformityMixMatchItem by bulk
Given a MixMatchData of the following:
|MMCode|MMQ|MMP|MMDescription|MMQ2|MMP2|
|0002  |3  |120|Discount100x3|6   |180 |

!-- 1ST Entry [Add entry with 3 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |50   |3  |0001       |
When I compute discount of 2ndStepUniformity
Then I should get {3} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0001       |10             |
|1       |0002          |0002         |Discount100x3  |0001       |10             |
|1       |0002          |0002         |Discount100x3  |0001       |10             |

!-- 2ND Entry [Add entry with 3 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |60   |3  |0002       |
When I compute discount of 2ndStepUniformity
Then I should get {6} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0002       |27             |
|1       |0002          |0002         |Discount100x3  |0002       |27             |
|1       |0002          |0002         |Discount100x3  |0002       |27             |
|2       |0002          |0002         |Discount100x3  |0001       |23             |
|2       |0002          |0002         |Discount100x3  |0001       |23             |
|2       |0002          |0002         |Discount100x3  |0001       |23             |

Scenario: Test SecondStepUniformityMixMatchItem by less value
Given a MixMatchData of the following:
|MMCode|MMQ|MMP|MMDescription|MMQ2|MMP2|
|0002  |3  |120|Discount100x3|6   |180 |

!-- 1ST Entry [Add entry with 3 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |50   |1  |0001       |
|ItemB |30   |1  |0002       |
|ItemB |80   |1  |0003       |
When I compute discount of 2ndStepUniformity
Then I should get {3} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0003       |20             |
|2       |0002          |0002         |Discount100x3  |0001       |13             |
|3       |0002          |0002         |Discount100x3  |0002       |7             |

Scenario: Test SecondStepUniformityMixMatchItem by less value
Given a MixMatchData of the following:
|MMCode|MMQ|MMP|MMDescription|MMQ2|MMP2|
|0002  |3  |120|Discount100x3|6   |180 |

!-- 1ST Entry [Add entry with 3 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |90   |1  |0001       |
|ItemB |60   |1  |0002       |
|ItemB |0    |1  |0003       |
When I compute discount of 2ndStepUniformity
Then I should get {3} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0001       |18             |
|2       |0002          |0002         |Discount100x3  |0002       |12             |
|3       |0002          |0002         |Discount100x3  |0003       |0             |

Scenario: Test SecondStepUniformityMixMatchItem by less value
Given a MixMatchData of the following:
|MMCode|MMQ|MMP|MMDescription|MMQ2|MMP2|
|0002  |3  |120|Discount100x3|6   |180 |

!-- 1ST Entry [Add entry with 3 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |0   |1  |0001       |
|ItemB |0   |1  |0002       |
|ItemB |0   |1  |0003       |
When I compute discount of 2ndStepUniformity
Then I should get {0} discounts

!-- 2ND Entry [Add entry with 2 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |60   |2  |0004       |
When I compute discount of 2ndStepUniformity
Then I should get {0} discounts

!-- 3RD Entry [Add entry with 3 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |140  |3  |0005       |
When I compute discount of 2ndStepUniformity
Then I should get {8} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0005       |93             |
|1       |0002          |0002         |Discount100x3  |0005       |93             |
|1       |0002          |0002         |Discount100x3  |0005       |93             |
|2       |0002          |0002         |Discount100x3  |0004       |40             |
|2       |0002          |0002         |Discount100x3  |0004       |40             |
|3       |0002          |0002         |Discount100x3  |0001       |0            |
|4       |0002          |0002         |Discount100x3  |0002       |0             |
|5       |0002          |0002         |Discount100x3  |0003       |1             |

Scenario: Test SecondStepUniformityMixMatchItem (1st Entry is Bundle)
Given a MixMatchData of the following:
|MMCode|MMQ|MMP|MMDescription|MMQ2|MMP2|
|0002  |3  |120|Discount100x3|6   |180 |

!-- 1ST Entry [Add entry with different quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemA |50   |3  |0001       |
|ItemA |20   |2  |0002       |
|ItemA |0    |1  |0003       |
When I compute discount of 2ndStepUniformity
Then I should get {6} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0001       |3              |
|1       |0002          |0002         |Discount100x3  |0001       |3              |
|1       |0002          |0002         |Discount100x3  |0001       |3              |
|2       |0002          |0002         |Discount100x3  |0002       |1              |
|2       |0002          |0002         |Discount100x3  |0002       |1              |
|3       |0002          |0002         |Discount100x3  |0003       |-1              |

Scenario: Test SecondStepUniformityMixMatchItem
Given a MixMatchData of the following:
|MMCode|MMQ|MMP|MMDescription|MMQ2|MMP2
|0002  |3  |120|Discount100x3|6   |180

!-- SINGLE ENTRIES (One Item_Entry)
!-- 1ST Entry [Add entry with 1 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemA |50   |1  |0001       |
When I compute discount of 2ndStepUniformity
Then I should get {0} discounts

!-- 2ND Entry [Add entry with 1 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |20   |1  |0002       |
When I compute discount of 2ndStepUniformity
Then I should get {0} discounts

!-- 3RD Entry [Add entry with 1 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |80   |1  |0003       |
When I compute discount of 2ndStepUniformity
Then I should get {3} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0003       |16             |
|2       |0002          |0002         |Discount100x3  |0001       |10             |
|3       |0002          |0002         |Discount100x3  |0002       |4             |

!-- 4TH Entry [Add entry with 1 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |35   |1  |0004       |
When I compute discount of 2ndStepUniformity
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0003       |19             |
|2       |0002          |0002         |Discount100x3  |0001       |12             |
|3       |0002          |0002         |Discount100x3  |0004       |9             |
|4       |0002          |0002         |Discount100x3  |0002       |5             |

!-- 5TH Entry [Add entry with 3 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |90   |3  |0005       |
When I compute discount of 2ndStepUniformity
Then I should get {7} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0005       |50             |
|1       |0002          |0002         |Discount100x3  |0005       |50             |
|1       |0002          |0002         |Discount100x3  |0005       |50             |
|2       |0002          |0002         |Discount100x3  |0003       |45             |
|3       |0002          |0002         |Discount100x3  |0001       |28             |
|4       |0002          |0002         |Discount100x3  |0004       |20             |
|5       |0002          |0002         |Discount100x3  |0002       |12             |

!-- 6TH Entry [Add entry with 4 quantity]
When I add item to sale:
|name  |price|qty|itementryid|
|ItemB |35   |4  |0006       |
When I compute discount of 2ndStepUniformity
Then I should get {11} discounts
Then I should get list of discounts of the following:
|rewardid|earnedrewardid|promotioncode|discdescription|itementryid|unitdiscountamt|
|1       |0002          |0002         |Discount100x3  |0005       |42             |
|1       |0002          |0002         |Discount100x3  |0005       |42             |
|1       |0002          |0002         |Discount100x3  |0005       |42             |
|2       |0002          |0002         |Discount100x3  |0003       |37             |
|3       |0002          |0002         |Discount100x3  |0001       |23             |
|4       |0002          |0002         |Discount100x3  |0004       |16             |
|5       |0002          |0002         |Discount100x3  |0006       |16             |
|5       |0002          |0002         |Discount100x3  |0006       |16             |
|5       |0002          |0002         |Discount100x3  |0006       |16             |
|5       |0002          |0002         |Discount100x3  |0006       |16             |
|6       |0002          |0002         |Discount100x3  |0002       |9             |