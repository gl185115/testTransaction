



Scenario: Test Update Existing Device with Existing Printer
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9998} with json{{"Name":"NewName", "DeviceID":"1111", "RetailStoreID":"000032", "LogAutoUpload":"1", "LogSize":"1", "SaveLogFile":"1", "POSLink":"1111", "PricingType":"1", "Printer":"103"}}
Then ResultCode should be 0
Then deviceid should be {1111}
Then devicename should be {NewName}
Then logsize should be {1}
Then savelogfile should be {1}
Then logautoupload should be {1}
Then retailstoreid should be {000032}
Then printerid string should be {103}
Then printer should be notnull
Then printerid should be 103
Then printername should be {Test Printer 3}
Then description should be {Unit test printer 3}
Then tillid should be {123}
Then linkposterminalid should be 1111
Then queuebusterlink should be {3}
Then authorizationlink should be {3}
Then signaturelink should be {3}


Scenario: Test Update Existing Device deviceid only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"DeviceID":"1212"}}
Then ResultCode should be 0
Then deviceid should be {1212}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}



Scenario: Test Update Existing Device logautoupload only greater than 0
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"LogAutoUpload":"7"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device logautoupload only less than 0
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"LogAutoUpload":"-7"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {0}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device logsize only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"LogSize":"7"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {7}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device logsize only set to 0
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"LogSize":"0"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
!-- should default to 3
Then logsize should be {3}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device savelogfile only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"SaveLogFile":"7"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {7}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device savelogfile only set to zero
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"SaveLogFile":"0"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
!-- should default to 40
Then savelogfile should be {40}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device poslink only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"POSLink":"7777"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 7777
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device pricingtype only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"PricingType":"7"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device QueueBusterLink only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"QueueBusterLink":"7"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {7}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device AuthorizationLink only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"AuthorizationLink":"7"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {7}
Then signaturelink should be {1}

Scenario: Test Update Existing Device SignatureLink only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"SignatureLink":"7"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {7}



Scenario: Test Update Existing Device with Non-Existing Printer
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9998} with json{{"DeviceID":"2222", "RetailStoreID":"000032", "LogAutoUpload":"2", "LogSize":"2", "SaveLogFile":"2", "POSLink":"2222", "PricingType":"2", "Printer":"111"}}
Then ResultCode should be 0
Then deviceid should be {2222}
Then devicename should be {DeviceName}
Then logsize should be {2}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000032}
Then printerid string should be {empty}
Then printer should be notnull
Then printerid should be null
Then printername should be {empty}
Then description should be {empty}
Then tillid should be {123}
Then linkposterminalid should be 2222
Then queuebusterlink should be {3}
Then authorizationlink should be {3}
Then signaturelink should be {3}


Scenario: Test Update Existing Device printer only
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"105"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {105}
Then printer should be notnull
Then printerid should be 105
Then printername should be {Test Printer 5}
Then description should be {Unit test printer 5}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device printer only (not existing. will update to printer 0)
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"125"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {empty}
Then printer should be notnull
Then printerid should be null
Then printername should be {empty}
Then description should be {empty}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device storeid only (sets the printer to the 0 since no printer 102 in storeid 000032)
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"RetailStoreID":"000032"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000032}
Then printerid string should be {empty}
Then printer should be notnull
Then printerid should be null
Then printername should be {empty}
Then description should be {empty}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}


Scenario: Test Update Existing Device (change printer to 105 then change storeid to 000032. should have existing printer)
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"105"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {105}
Then printer should be notnull
Then printerid should be 105
Then printername should be {Test Printer 5}
Then description should be {Unit test printer 5}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"RetailStoreID":"000032"}}
Then ResultCode should be 0 
Then deviceid should be {9999}
Then devicename should be {} 
Then logsize should be {1} 
Then savelogfile should be {2} 
Then logautoupload should be {1} 
Then retailstoreid should be {000032} 
Then printerid string should be {105}
Then printer should be notnull
Then printerid should be 105
Then printername should be {Alt Test Printer 5}
Then description should be {Alt Unit test printer 5}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Testing update of printerid and storeid
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"104", "RetailStoreID":"000032"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000032}
Then printerid string should be {104}
!-- printer should be 104
Then printer should be notnull
Then printerid should be 104
Then printername should be {Test Printer 4}
Then description should be {Unit test printer 4}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

When I update DeviceInfo for storeid{000032} and deviceid{9999} with json{{"Printer":"103", "RetailStoreID":"000031"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {empty}
!-- printer should be 0
Then printer should be notnull
Then printerid should be null
Then printername should be {empty}
Then description should be {empty}
Then linkposterminalid should be 1234
Then tillid should be {123}

When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"RetailStoreID":"000032"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000032}
Then printerid string should be {empty}
!-- printer should be 0
Then printer should be notnull
Then printerid should be null
Then printername should be {empty}
Then description should be {empty}
Then tillid should be {123}

When I update DeviceInfo for storeid{000032} and deviceid{9999} with json{{"Printer":"103"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000032}
Then printerid string should be {103}
!-- printer should be 103
Then printer should be notnull
Then printerid should be 103
Then printername should be {Test Printer 3}
Then description should be {Unit test printer 3}
Then tillid should be {123}
Then linkposterminalid should be 1234

When I update DeviceInfo for storeid{000032} and deviceid{9999} with json{{"RetailStoreID":"000031"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {empty}
!-- printer should be 0
Then printer should be notnull
Then printerid should be null
Then printername should be {empty}
Then description should be {empty}
Then linkposterminalid should be 1234
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"5"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {empty}
!-- printer should be 0
Then printer should be notnull
Then printerid should be null
Then printername should be {empty}
Then description should be {empty}
Then tillid should be {123}
Then linkposterminalid should be 1234

When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"101"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {101}
!-- printer should be 101
Then printer should be notnull
Then printerid should be 101
Then printername should be {Test Printer 1}
Then description should be {Unit test printer 1}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}


Scenario: Invalid parameters. storeid = null
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{null} and deviceid{9999} with json{{"Printer":"105"}}
Then ResultCode should be 224

Scenario: Invalid parameters. storeid = empty
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{empty} and deviceid{9999} with json{{"Printer":"105"}}
Then ResultCode should be 224

Scenario: Invalid parameters. deviceid = null
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{null} with json{{"Printer":"105"}}
Then ResultCode should be 224

Scenario: Invalid parameters. deviceid = empty
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{empty} with json{{"Printer":"105"}}
Then ResultCode should be 224

Scenario: Invalid parameters. json = null
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{null}
Then ResultCode should be 224

Scenario: Invalid parameters. json = empty
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{empty}
Then ResultCode should be 224

Scenario: device not found
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000032} and deviceid{0000} with json{{"Printer":"105"}}
Then ResultCode should be 223

Scenario: already existing
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"DeviceID":"9998"}}
Then ResultCode should be 225

Scenario: Test Update Existing Device with Non-Existing RetailStoreID
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"DeviceID":"2222", "RetailStoreID":"000033", "LogAutoUpload":"2", "LogSize":"2", "SaveLogFile":"2", "POSLink":"2222", "PricingType":"2", "Printer":"111"}}
Then ResultCode should be 710

Scenario: Test Update Existing Device with Blank RetailStoreID
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"DeviceID":"2222", "RetailStoreID":""}}
Then ResultCode should be 0
Then deviceid should be {2222}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {102}
Then printer should be notnull
Then printerid should be 102
Then printername should be {Test Printer 2}
Then description should be {Unit test printer 2}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}

Scenario: Test Update Existing Device with new PrinterId equal to 105
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"105"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then printerid assigned to device with id {9999} in store {000031} should be 105
Then printername should be {Test Printer 5}
Then description should be {Unit test printer 5}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}


Scenario: Test Update Existing Device with new PrinterId equal to 0
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"0"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then printerid assigned to device with id {9999} in store {000031} should be 0
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}



Scenario: Test Update Existing Device with new PrinterId equal to -1
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"Printer":"-1"}}
Then ResultCode should be 0
Then deviceid should be {9999}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then printerid assigned to device with id {9999} in store {000031} should be -1
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}



Scenario: Test Update Existing Device with Empty DeviceName, TillId, PosLink, QueueBusterLink, AuthorizationLink and SignatureLink	
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I update DeviceInfo for storeid{000031} and deviceid{9998} with json{{"Name":"", "DeviceID":"1111", "RetailStoreID":"000032", "TillID":"", "LogAutoUpload":"1", "LogSize":"1", "SaveLogFile":"1", "POSLink":"", "QueueBusterLink":"", "AuthorizationLink":"", "SignatureLink":"","PricingType":"1", "Printer":""}}
Then ResultCode should be 0
Then deviceid should be {1111}
Then devicename should be {}
Then logsize should be {1}
Then savelogfile should be {1}
Then logautoupload should be {1}
Then retailstoreid should be {000032}
Then printerid string should be {}
Then queuebusterlink should be {}
Then authorizationlink should be {}
Then signaturelink should be {}
Then tillid should be {}
Then linkposterminalid should be {empty}

Scenario: Test Update using DELETED device identity
Given an initial deviceinfo entry in database
Given entries in MST_PRINTERINFO database table
Given a DeviceInfo service
When I delete device{9997} of store{000031}
Then ResultCode after delete should be 0

Then the MST_DEVICEINFO database table should have the following row(s):
|storeid|terminalid	|lasttxId	|lastsuspendtxId|
|000031	|9990		|null		|null			|
|000031	|9997		|null		|null			|
|000031	|9998		|null		|null			|
|000031	|9999		|null		|null			|
|000032	|9998		|null		|null			|

When I update DeviceInfo for storeid{000031} and deviceid{9999} with json{{"DeviceID":"9997", "Printer":"105", "Name":"New Device Name", "Txid":2}}
Then ResultCode should be 0
Then deviceid should be {9997}
Then devicename should be {New Device Name}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {105}
Then printer should be notnull
Then printerid assigned to device with id {9997} in store {000031} should be 105
Then printername should be {Test Printer 5}
Then description should be {Unit test printer 5}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}
Then Txid should be {2}
Then the MST_DEVICEINFO database table should have the following row(s):
|storeid|terminalid	|lasttxId	|lastsuspendtxId|
|000031	|9990		|null		|null			|
|000031	|9997		|2			|null			|
|000031	|9998		|null		|null			|
|000031	|9999		|null		|null			|
|000032	|9998		|null		|null			|

!-- Update the same record but doesn't specify the Txid. Then, should still leave the values in DB as it is
When I update DeviceInfo for storeid{000031} and deviceid{9997} with json{{"DeviceID":"9997", "Printer":"105", "Name":"New Device Name"}}
Then ResultCode should be 0
Then deviceid should be {9997}
Then devicename should be {New Device Name}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {105}
Then printer should be notnull
Then printerid assigned to device with id {9997} in store {000031} should be 105
Then printername should be {Test Printer 5}
Then description should be {Unit test printer 5}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}
Then Txid should be {2}
Then the MST_DEVICEINFO database table should have the following row(s):
|storeid|terminalid	|lasttxId	|lastsuspendtxId|
|000031	|9990		|null		|null			|
|000031	|9997		|2			|null			|
|000031	|9998		|null		|null			|
|000031	|9999		|null		|null			|
|000032	|9998		|null		|null			|


!-- Will not allow update of TxId to "" (empty) since Txid is numeric in DB.
When I update DeviceInfo for storeid{000031} and deviceid{9997} with json{{"DeviceID":"9997", "Printer":"105", "Name":"New Device Name", "Txid":""}}
Then ResultCode should be 134
Then the MST_DEVICEINFO database table should have the following row(s):
|storeid|terminalid	|lasttxId	|lastsuspendtxId|
|000031	|9990		|null		|null			|
|000031	|9997		|2			|null			|
|000031	|9998		|null		|null			|
|000031	|9999		|null		|null			|
|000032	|9998		|null		|null			|

!-- Update LastSuspendTxId
When I update DeviceInfo for storeid{000031} and deviceid{9997} with json{{"DeviceID":"9997", "Printer":"105", "Name":"New Device Name", "SuspendTxid":3}}
Then ResultCode should be 0
Then deviceid should be {9997}
Then devicename should be {New Device Name}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {105}
Then printer should be notnull
Then printerid assigned to device with id {9997} in store {000031} should be 105
Then printername should be {Test Printer 5}
Then description should be {Unit test printer 5}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}
Then Txid should be {2}
Then LastSuspendTxId should be {3}
Then the MST_DEVICEINFO database table should have the following row(s):
|storeid|terminalid	|lasttxId	|lastsuspendtxId|
|000031	|9990		|null		|null			|
|000031	|9997		|2			|3				|
|000031	|9998		|null		|null			|
|000031	|9999		|null		|null			|
|000032	|9998		|null		|null			|

!-- Update the same record but doesn't specify the LastSuspendTxId. Then, should still leave the values in DB as it is
When I update DeviceInfo for storeid{000031} and deviceid{9997} with json{{"DeviceID":"9997", "Printer":"105", "Name":"New Device Name"}}
Then ResultCode should be 0
Then deviceid should be {9997}
Then devicename should be {New Device Name}
Then logsize should be {1}
Then savelogfile should be {2}
Then logautoupload should be {1}
Then retailstoreid should be {000031}
Then printerid string should be {105}
Then printer should be notnull
Then printerid assigned to device with id {9997} in store {000031} should be 105
Then printername should be {Test Printer 5}
Then description should be {Unit test printer 5}
Then tillid should be {123}
Then linkposterminalid should be 1234
Then queuebusterlink should be {1}
Then authorizationlink should be {1}
Then signaturelink should be {1}
Then Txid should be {2}
Then LastSuspendTxId should be {3}
Then the MST_DEVICEINFO database table should have the following row(s):
|storeid|terminalid	|lasttxId	|lastsuspendtxId|
|000031	|9990		|null		|null			|
|000031	|9997		|2			|3				|
|000031	|9998		|null		|null			|
|000031	|9999		|null		|null			|
|000032	|9998		|null		|null			|

!-- Will not allow update of LastSuspendTxId to "" (empty) since LastSuspendTxId is numeric in DB.
When I update DeviceInfo for storeid{000031} and deviceid{9997} with json{{"DeviceID":"9997", "Printer":"105", "Name":"New Device Name", "SuspendTxid":""}}
Then ResultCode should be 134
Then the MST_DEVICEINFO database table should have the following row(s):
|storeid|terminalid	|lasttxId	|lastsuspendtxId|
|000031	|9990		|null		|null			|
|000031	|9997		|2			|3				|
|000031	|9998		|null		|null			|
|000031	|9999		|null		|null			|
|000032	|9998		|null		|null			|


