Scenario: Test Item Entry with MixMatch Type 1
When the Web API Starts Up
Given a Promotion Service
Given a loaded dataset {items_for_aliquant_mixmatch.xml}
Given a loaded dataset {mixmatch_aliquant_promotions.xml}

Scenario: Item Entry (aliquant 1 (MMQ=2,MMP=525,PPI=262.5..) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"3333333333332","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |3333333333332|EAN-13    |1       |0143      |aliquant product 2|割り切れない製品2     |546.0                |0.0     |0.0           |546.0               |546.0         |True        |0                |0         |
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"3333333333331","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |3333333333331|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match Aliquant Type 3|00001|207|
|2|1003|1003|Mix Match Aliquant Type 3|00002|114|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"3333333333331","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |3333333333331|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match Aliquant Type 3|00001|171|
|2|1003|1003|Mix Match Aliquant Type 3|00002|94|
|3|1003|1003|Mix Match Aliquant Type 3|00003|93|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"3333333333331","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |3333333333331|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match Aliquant Type 3|00001|150|
|2|1003|1003|Mix Match Aliquant Type 3|00002|82|
|3|1003|1003|Mix Match Aliquant Type 3|00003|82|
|4|1003|1003|Mix Match Aliquant Type 3|00004|82|

Scenario: Item Entry (aliquant 2 (MMQ=2,MMP=525,PPI=262.5..) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"3333333333332","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |3333333333332|EAN-13    |2       |0143      |aliquant product 2|割り切れない製品2     |546.0                |0.0     |0.0           |546.0               |1092.0        |True        |0                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match Aliquant Type 3|00001|567|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"3333333333331","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |3333333333331|EAN-13    |2       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |600.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match Aliquant Type 3|00001|414|
|2|1003|1003|Mix Match Aliquant Type 3|00002|228|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"3333333333331","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |3333333333331|EAN-13    |1       |0143      |aliquant product 1|割り切れない製品1     |300.0                |0.0     |0.0           |300.0               |300.0         |True        |0                |null      |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1003|1003|Mix Match Aliquant Type 3|00001|372|
|2|1003|1003|Mix Match Aliquant Type 3|00002|204|
|3|1003|1003|Mix Match Aliquant Type 3|00003|103|

Scenario: Item Entry (aliquant 3 (MMQ=3,MMP=253,PPI=84.333333..) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"3333333333333","ItemIDType":"EAN-13","Quantity":3}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |3333333333333|EAN-13    |3       |0143      |aliquant product 3|割り切れない製品3     |90.0                 |0.0     |0.0           |90.0                |270.0         |True        |1                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1013|1013|Mix Match Aliquant 2 Type 3|00001|17|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"3333333333333","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |3333333333333|EAN-13    |1       |0143      |aliquant product 3|割り切れない製品3     |90.0                 |0.0     |0.0           |90.0                |90.0          |True        |1                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1013|1013|Mix Match Aliquant 2 Type 3|00001|18|
|2|1013|1013|Mix Match Aliquant 2 Type 3|00002|4|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"3333333333333","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |3333333333333|EAN-13    |1       |0143      |aliquant product 3|割り切れない製品3     |90.0                 |0.0     |0.0           |90.0                |90.0          |True        |1                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1013|1013|Mix Match Aliquant 2 Type 3|00001|15|
|2|1013|1013|Mix Match Aliquant 2 Type 3|00002|5|
|3|1013|1013|Mix Match Aliquant 2 Type 3|00003|7|

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"3333333333333","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |3333333333333|EAN-13    |1       |0143      |aliquant product 3|割り切れない製品3     |90.0                 |0.0     |0.0           |90.0                |90.0          |True        |1                |0         |
Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1013|1013|Mix Match Aliquant 2 Type 3|00001|18|
|2|1013|1013|Mix Match Aliquant 2 Type 3|00002|6|
|3|1013|1013|Mix Match Aliquant 2 Type 3|00003|6|
|4|1013|1013|Mix Match Aliquant 2 Type 3|00004|4|

Scenario: Item Entry (aliquant 3 (MMQ=3,MMP=250,PPI=225) 
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"3333333333334","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |3333333333334|EAN-13    |1       |0143      |aliquant product 4|割り切れない製品4     |100.0                |0.0     |0.0           |100.0               |100.0         |True        |1                |1         |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"3333333333334","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |3333333333334|EAN-13    |1       |0143      |aliquant product 4|割り切れない製品4     |100.0                |0.0     |0.0           |100.0               |100.0         |True        |1                |1         |

When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"3333333333335","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN     |DescriptionJP     |RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00003      |3333333333335|EAN-13    |1       |0143      |aliquant product 5|割り切れない製品5     |70.0                 |0.0     |0.0           |70.0                |70.0          |True        |0                |1         |

Then promotion should have the following data :
|RewardID|EarnedRewardID|PromotionCode|DiscountDescription|ItemEntryID|UnitDiscountAmount|
|1|1014|1014|Mix Match Aliquant 3 Type 1|00001|7|
|2|1014|1014|Mix Match Aliquant 3 Type 1|00002|7|
|3|1014|1014|Mix Match Aliquant 3 Type 1|00003|6|