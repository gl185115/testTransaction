Scenario: Journalization of a normal transaction without customer info
Given a Journalization Resource
Given a RESMaster DBInitiator
Given MST_DEVICEINFO table
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>5001</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 4209
Then status should be {OK}

Scenario: Journalization of a normal transaction with only customer demographic
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>5001</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 4209
Then status should be {OK}

Scenario: Journalization of a normal transaction with customer details
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>5001</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerID>123456</CustomerID><Name></Name><TelephoneNumber></TelephoneNumber><eMail></eMail></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 4209
Then status should be {OK}

Scenario: Journalization of a return transaction without customer info
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given a corpid{111}
Given returned transaction 0074 is inserted
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 0075
Then status should be {OK}

Scenario: Journalization of a return transaction with only customer demographic
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given a corpid{111}
Given returned transaction 0074 is inserted
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 0075
Then status should be {OK}

Scenario: Journalization of a return transaction with customer details
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given a corpid{111}
Given returned transaction 0074 is inserted
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerID>123456</CustomerID><Name></Name><TelephoneNumber></TelephoneNumber><eMail></eMail></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 0075
Then status should be {OK}

Scenario: Journalization of a return without receipt transaction without customer info
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given a corpid{111}
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 1234
Then status should be {OK}

Scenario: Journalization of a return without receipt transaction with only customer demographic
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given a corpid{111}
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 1234
Then status should be {OK}

Scenario: Journalization of a return without receipt transaction with customer details
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given a corpid{111}
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>1234</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerID>123456</CustomerID><Name></Name><TelephoneNumber></TelephoneNumber><eMail></eMail></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>}
	and operatorno{111}
Then result should be {OK}
Then txid should be 1234
Then status should be {OK}

Scenario: Journalization of a cancel transaction without customer info
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction CancelFlag="True"><RetailStoreID>0031</RetailStoreID><WorkstationID>5001</WorkstationID><SequenceNumber>4230</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><ItemCount>4</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>51</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>37</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">468</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>-126</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>50</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>36</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">459</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>720</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>01</PriceDerivationRuleID></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>53</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">667</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Tax TaxType="Sales"><Amount>0</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">0</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal"></Total><Total TotalType="TransactionGrandAmount"></Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 4230
Then status should be {OK}

Scenario: Journalization of a cancel transaction with only customer demographic
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction CancelFlag="True"><RetailStoreID>0031</RetailStoreID><WorkstationID>5001</WorkstationID><SequenceNumber>4230</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>4</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>51</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>37</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">468</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>-126</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item  B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>50</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>36</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">459</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>720</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>01</PriceDerivationRuleID></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>53</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">667</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Tax TaxType="Sales"><Amount>0</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">0</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal"></Total><Total TotalType="TransactionGrandAmount"></Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 4230
Then status should be {OK}

Scenario: Journalization of a cancel transaction with customer details
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction CancelFlag="True"><RetailStoreID>0031</RetailStoreID><WorkstationID>5001</WorkstationID><SequenceNumber>4230</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerID>123456</CustomerID><Name></Name><TelephoneNumber></TelephoneNumber><eMail></eMail></Customer><ItemCount>4</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>51</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>37</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">468</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>-126</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>50</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>36</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">459</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>720</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>01</PriceDerivationRuleID></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>53</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">667</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Tax TaxType="Sales"><Amount>0</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">0</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal"></Total><Total TotalType="TransactionGrandAmount"></Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 4230
Then status should be {OK}

Scenario: Journalization of a void transaction without customer info
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given normal transaction 4209 is inserted
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4211</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:06:30</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:06:32</ReceiptDateTime><TillID>0</TillID><RetailTransaction TransactionStatus="Voided"><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><TransactionLink ReasonCode="Voided"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 4211
Then status should be {OK}
Then table {TXL_SALES_JOURNAL} will have {2} row(s)
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |4209          |2014-04-07     |2014-04-07 16:05:42.0|Sale  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="PriceOverride"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0005</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="CreditDebit" TypeCode="Sale"><Amount>1548</Amount><Tax><Amount>114</Amount></Tax><Voucher><VoucherID>12345</VoucherID></Voucher><Authorization SignatureRequiredFlag="false"><AuthorizationCode>004444</AuthorizationCode><RequestingTerminalID>4969380800020</RequestingTerminalID><AuthorizationDateTime>13/12/10 11:12:04</AuthorizationDateTime><ReferenceNumber>131210-00010001-12345-03200</ReferenceNumber></Authorization><CreditDebit CardType="Credit"><CardIssuerID>012</CardIssuerID><IssueSequence>496938080002012345</IssueSequence><IssuerName>NCR CARD</IssuerName><AccountNumber>xxxxxxxxxxxx4321</AccountNumber><PaymentMethod PaymentMethodCode="0" PaymentMethodName="??"><Ndivided>1</Ndivided></PaymentMethod></CreditDebit></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
|0031         |4567         |4211          |2014-04-07     |2014-04-07 16:06:30.0|Void  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4211</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:06:30</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:06:32</ReceiptDateTime><TillID>0</TillID><RetailTransaction TransactionStatus="Voided"><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><TransactionLink ReasonCode="Voided"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
Then table {TXL_SALES_VOIDED} will have {1} row(s)
Then the TXL_SALES_VOIDED database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|TxType|
|0031         |4567         |4209          |2014-04-07     |Void  |

Scenario: Journalization of a void transaction with only customer demographic
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given normal transaction 4209 is inserted
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4211</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:06:30</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:06:32</ReceiptDateTime><TillID>0</TillID><RetailTransaction TransactionStatus="Voided"><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Voided"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 4211
Then status should be {OK}
Then table {TXL_SALES_JOURNAL} will have {2} row(s)
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |4209          |2014-04-07     |2014-04-07 16:05:42.0|Sale  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="PriceOverride"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0005</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="CreditDebit" TypeCode="Sale"><Amount>1548</Amount><Tax><Amount>114</Amount></Tax><Voucher><VoucherID>12345</VoucherID></Voucher><Authorization SignatureRequiredFlag="false"><AuthorizationCode>004444</AuthorizationCode><RequestingTerminalID>4969380800020</RequestingTerminalID><AuthorizationDateTime>13/12/10 11:12:04</AuthorizationDateTime><ReferenceNumber>131210-00010001-12345-03200</ReferenceNumber></Authorization><CreditDebit CardType="Credit"><CardIssuerID>012</CardIssuerID><IssueSequence>496938080002012345</IssueSequence><IssuerName>NCR CARD</IssuerName><AccountNumber>xxxxxxxxxxxx4321</AccountNumber><PaymentMethod PaymentMethodCode="0" PaymentMethodName="??"><Ndivided>1</Ndivided></PaymentMethod></CreditDebit></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
|0031         |4567         |4211          |2014-04-07     |2014-04-07 16:06:30.0|Void  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4211</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:06:30</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:06:32</ReceiptDateTime><TillID>0</TillID><RetailTransaction TransactionStatus="Voided"><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Voided"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
Then table {TXL_SALES_VOIDED} will have {1} row(s)
Then the TXL_SALES_VOIDED database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|TxType|
|0031         |4567         |4209          |2014-04-07     |Void  |

Scenario: Journalization of a void transaction with customer details
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given normal transaction 4209 is inserted
When executing journal log with xml{<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4211</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:06:30</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:06:32</ReceiptDateTime><TillID>0</TillID><RetailTransaction TransactionStatus="Voided"><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerID>123456</CustomerID><Name></Name><TelephoneNumber></TelephoneNumber><eMail></eMail></Customer><TransactionLink ReasonCode="Voided"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>} 
	and operatorno{111}
Then result should be {OK}
Then txid should be 4211
Then status should be {OK}
Then table {TXL_SALES_JOURNAL} will have {2} row(s)
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |4209          |2014-04-07     |2014-04-07 16:05:42.0|Sale  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="PriceOverride"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0005</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="CreditDebit" TypeCode="Sale"><Amount>1548</Amount><Tax><Amount>114</Amount></Tax><Voucher><VoucherID>12345</VoucherID></Voucher><Authorization SignatureRequiredFlag="false"><AuthorizationCode>004444</AuthorizationCode><RequestingTerminalID>4969380800020</RequestingTerminalID><AuthorizationDateTime>13/12/10 11:12:04</AuthorizationDateTime><ReferenceNumber>131210-00010001-12345-03200</ReferenceNumber></Authorization><CreditDebit CardType="Credit"><CardIssuerID>012</CardIssuerID><IssueSequence>496938080002012345</IssueSequence><IssuerName>NCR CARD</IssuerName><AccountNumber>xxxxxxxxxxxx4321</AccountNumber><PaymentMethod PaymentMethodCode="0" PaymentMethodName="??"><Ndivided>1</Ndivided></PaymentMethod></CreditDebit></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
|0031         |4567         |4211          |2014-04-07     |2014-04-07 16:06:30.0|Void  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4211</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:06:30</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:06:32</ReceiptDateTime><TillID>0</TillID><RetailTransaction TransactionStatus="Voided"><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerID>123456</CustomerID><Name></Name><TelephoneNumber></TelephoneNumber><eMail></eMail></Customer><TransactionLink ReasonCode="Voided"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
Then table {TXL_SALES_VOIDED} will have {1} row(s)
Then the TXL_SALES_VOIDED database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|TxType|
|0031         |4567         |4209          |2014-04-07     |Void  |