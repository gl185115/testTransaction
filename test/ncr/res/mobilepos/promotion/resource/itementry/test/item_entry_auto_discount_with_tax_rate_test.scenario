Scenario: Test Item Entry with Automatic Discount with Tax Rate.
When the Web API Starts Up with {prm_system_config_12taxrate_roundup.xml} System Configuration
Given a Promotion Service
Given a loaded dataset {items_autodiscount_for_taxrate_12taxrate.xml}

Scenario: Item Entry with No begin Transaction
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"ItemEntryID":"00001","ItemID":"3365545775621","ItemIDType":"EAN-13","Quantity":1}}
Then the Result Code is 1102

Scenario: Item Entry with no retail store id
When a Item Entry at promotion with parameters RetailStoreID{} WorkStationId{1111} SequenceNo{1} TransactionJson{{"ItemEntryID":"00001","ItemID":"3365545775621","ItemIDType":"EAN-13","Quantity":1}}
Then the Result Code is 154

Scenario: Item Entry with no workstation id
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{} SequenceNo{1} TransactionJson{{"ItemEntryID":"00001","ItemID":"3365545775621","ItemIDType":"EAN-13","Quantity":1}}
Then the Result Code is 154

Scenario: Item Entry with no sequence number
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{} TransactionJson{{"ItemEntryID":"00001","ItemID":"3365545775621","ItemIDType":"EAN-13","Quantity":1}}
Then the Result Code is 154

Scenario: Item Entry with no transaction
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{}
Then the Result Code is 154

Scenario: Item Entry with Invalid Transaction 1
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{asdas}
Then the Result Code is 154

Scenario: Item Entry with Invalid Transaction 2
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{}}
Then the Result Code is 154
Then the JSON should have the following format : 
{"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry with No begin Transaction (other device)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1112} SequenceNo{1} TransactionJson{{"ItemEntryID":"00001","ItemID":"3365545775621","ItemIDType":"EAN-13","Quantity":1}}
Then the Result Code is 1102

Scenario: Item Entry with Item Not Found
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"4900000000153","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 801
Then the JSON should have the following format : 
{"NCRWSSResultCode":801,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry Empty ItemId
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 801
Then the JSON should have the following format : 
{"NCRWSSResultCode":801,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry Empty ItemEntryId
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"","ItemID":"4900000000153","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 154
Then the JSON should have the following format : 
{"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry No ItemEntryId
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemID":"4900000000153","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 154
Then the JSON should have the following format : 
{"NCRWSSResultCode":154,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry no ItemId
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 801
Then the JSON should have the following format : 
{"NCRWSSResultCode":801,"NCRWSSExtendedResultCode":0}

!-- ITEM ENTRIES WITH DISCOUNT AMOUNT (WITH 12% TAX RATE) 
Scenario: Item Entry with Auto Discount amount
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00001","ItemID":"4765545775621","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00001      |4765545775621|EAN-13    |1       |0143      |Goodies      |グッズ                      |5600.0               |0.0     |200.0         |5400.0              |5400.0        |True        |0                |null      |

Scenario: Item Entry with Auto Discount amount (multiple quantity)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00002","ItemID":"4765545775621","ItemIDType":"EAN-13","Quantity":3}}}
Then the Result Code is 0
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00002      |4765545775621|EAN-13    |3       |0143      |Goodies      |グッズ                      |5600.0               |0.0     |200.0         |5400.0              |16200.0       |True        |0                |null      |

Scenario: Item Entry an item with auto discount amount (single quantity, but not discountable)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00003","ItemID":"4765545775555","ItemIDType":"EAN-13","Quantity":1}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"4765545775555","Department":"0143","Description":{"en":"iRobot","jp":"アイロボット"},"RegularSalesUnitPrice":60480.0,"Discount":0.0,"DiscountFlag":-1,"DiscountAmount":0.0,"ActualSalesUnitPrice":60480.0,"Discountable":false,"TaxRate":12,"TaxType":0,"DiscountType":1,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"1","EmpPrice1":60480.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00003","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":60480.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry an item with auto discount amount (multiple quantity, but not discountable)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00004","ItemID":"4765545775555","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"4765545775555","Department":"0143","Description":{"en":"iRobot","jp":"アイロボット"},"RegularSalesUnitPrice":60480.0,"Discount":0.0,"DiscountFlag":-1,"DiscountAmount":0.0,"ActualSalesUnitPrice":60480.0,"Discountable":false,"TaxRate":12,"TaxType":0,"DiscountType":1,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":0,"CouponFlag":"1","EmpPrice1":60480.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00004","ItemIDType":"EAN-13","Quantity":2,"ExtendedAmount":120960.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00004      |4765545775555|EAN-13    |2       |0143      |iRobot       |アイロボット             |60480.0              |0.0     |0.0           |60480.0             |120960.0      |False       |0                |1         |

!-- ITEM ENTRIES WITH AUTO DISCOUNT RATE (WITH 12% TAX RATE)
Scenario: Item Entry with Auto Discount Rate
When a Begin Transaction at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"TransactionMode":"0","OperatorID": "0003","BeginDateTime":"2012-12-20T09:30:47.00"}}
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00005","ItemID":"4765545775623","ItemIDType":"EAN-13","Quantity":1}}}
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00005      |4765545775623|EAN-13    |1       |0143      |Camera       |カメラ                      |13440.0              |30.0    |4032.0        |9408.0              |9408.0        |True        |1                |1         |
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"4765545775623","Department":"0143","Description":{"en":"Camera","jp":"カメラ"},"RegularSalesUnitPrice":13440.0,"Discount":30.0,"DiscountFlag":1,"DiscountAmount":4032.0,"ActualSalesUnitPrice":9408.0,"Discountable":true,"TaxRate":12,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":13440.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00005","ItemIDType":"EAN-13","Quantity":1,"ExtendedAmount":9408.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}

Scenario: Item Entry with Auto Discount Rate (multiple quantity)
When a Item Entry at promotion with parameters RetailStoreID{0031} WorkStationId{1111} SequenceNo{1} TransactionJson{{"Sale":{"ItemEntryID":"00006","ItemID":"4765545775623","ItemIDType":"EAN-13","Quantity":2}}}
Then the Result Code is 0
Then the JSON should have the following format : 
{"Transaction":{"TransactionMode":0,"Sale":{"ItemID":"4765545775623","Department":"0143","Description":{"en":"Camera","jp":"カメラ"},"RegularSalesUnitPrice":13440.0,"Discount":30.0,"DiscountFlag":1,"DiscountAmount":4032.0,"ActualSalesUnitPrice":9408.0,"Discountable":true,"TaxRate":12,"TaxType":0,"DiscountType":0,"NonSales":0,"SubInt10":0,"Line":"0143","Class":"000001","AgeRestrictedFlag":1,"CouponFlag":"1","EmpPrice1":13440.0,"PSType":"","OrgSalesPrice1":0.0,"ItemEntryID":"00006","ItemIDType":"EAN-13","Quantity":2,"ExtendedAmount":18816.0,"InputType":0},"EntryFlag":0},"NCRWSSResultCode":0,"NCRWSSExtendedResultCode":0}
Then Sale data should be :
|ItemEntryID|ItemID       |ItemIDType|Quantity|Department|DescriptionEN|DescriptionJP|RegularSalesUnitPrice|Discount|DiscountAmount|ActualSalesUnitPrice|ExtendedAmount|Discountable|AgeRestrictedFlag|CouponFlag|
|00006      |4765545775623|EAN-13    |2       |0143      |Camera       |カメラ                      |13440.0              |30.0    |4032.0        |9408.0              |18816.0       |True        |1                |1         |
