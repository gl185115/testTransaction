Scenario: Journalize & Re-journalize Return Transaction (Duplicate)
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given a corpid111
Given returned transaction 0074 is inserted
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK
Then txid should be 0075
Then status should be OK
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx|
|0031         |4567         |74            |2014-04-07     |2014-04-07 16:05:42.0|Sale  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="PriceOverride"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0005</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="CreditDebit" TypeCode="Sale"><Amount>1548</Amount><Tax><Amount>114</Amount></Tax><Voucher><VoucherID>12345</VoucherID></Voucher><Authorization SignatureRequiredFlag="false"><AuthorizationCode>004444</AuthorizationCode><RequestingTerminalID>4969380800020</RequestingTerminalID><AuthorizationDateTime>13/12/10 11:12:04</AuthorizationDateTime><ReferenceNumber>131210-00010001-12345-03200</ReferenceNumber></Authorization><CreditDebit CardType="Credit"><CardIssuerID>012</CardIssuerID><IssueSequence>496938080002012345</IssueSequence><IssuerName>NCR CARD</IssuerName><AccountNumber>xxxxxxxxxxxx4321</AccountNumber><PaymentMethod PaymentMethodCode="0" PaymentMethodName="??"><Ndivided>1</Ndivided></PaymentMethod></CreditDebit></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>|
|0031         |4567         |75            |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>|
Then the TXL_SALES_VOIDED database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|TxType|
|0031         |4567         |74            |2014-04-07     |Return|

!-- Re-journalize Previous Returned Transaction
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |74            |2014-04-07     |2014-04-07 16:05:42.0|Sale  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="PriceOverride"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0005</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="CreditDebit" TypeCode="Sale"><Amount>1548</Amount><Tax><Amount>114</Amount></Tax><Voucher><VoucherID>12345</VoucherID></Voucher><Authorization SignatureRequiredFlag="false"><AuthorizationCode>004444</AuthorizationCode><RequestingTerminalID>4969380800020</RequestingTerminalID><AuthorizationDateTime>13/12/10 11:12:04</AuthorizationDateTime><ReferenceNumber>131210-00010001-12345-03200</ReferenceNumber></Authorization><CreditDebit CardType="Credit"><CardIssuerID>012</CardIssuerID><IssueSequence>496938080002012345</IssueSequence><IssuerName>NCR CARD</IssuerName><AccountNumber>xxxxxxxxxxxx4321</AccountNumber><PaymentMethod PaymentMethodCode="0" PaymentMethodName="??"><Ndivided>1</Ndivided></PaymentMethod></CreditDebit></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
|0031         |4567         |75            |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
Then the TXL_SALES_VOIDED database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|TxType|
|0031         |4567         |74            |2014-04-07     |Return|

Scenario: Normal Transaction(Transaction To Be Returned) Not Found
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given a corpid111
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |75            |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>

Scenario: Invalid Transaction Link (Transaction Link is not of Sale type)
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given a corpid111
Given returned transaction 0074_Cancel is inserted
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK

Scenario: Original Transaction already voided
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given a corpid111
Given normal transaction 4209 is inserted
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Void</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4211</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:06:30</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:06:32</ReceiptDateTime><TillID>0</TillID><RetailTransaction TransactionStatus="Voided"><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Voided"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK
Then txid should be 4211
Then status should be OK
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |4209          |2014-04-07     |2014-04-07 16:05:42.0|Sale  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="PriceOverride"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0005</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="CreditDebit" TypeCode="Sale"><Amount>1548</Amount><Tax><Amount>114</Amount></Tax><Voucher><VoucherID>12345</VoucherID></Voucher><Authorization SignatureRequiredFlag="false"><AuthorizationCode>004444</AuthorizationCode><RequestingTerminalID>4969380800020</RequestingTerminalID><AuthorizationDateTime>13/12/10 11:12:04</AuthorizationDateTime><ReferenceNumber>131210-00010001-12345-03200</ReferenceNumber></Authorization><CreditDebit CardType="Credit"><CardIssuerID>012</CardIssuerID><IssueSequence>496938080002012345</IssueSequence><IssuerName>NCR CARD</IssuerName><AccountNumber>xxxxxxxxxxxx4321</AccountNumber><PaymentMethod PaymentMethodCode="0" PaymentMethodName="??"><Ndivided>1</Ndivided></PaymentMethod></CreditDebit></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
|0031         |4567         |4211          |2014-04-07     |2014-04-07 16:06:30.0|Void  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Void</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4211</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:06:30</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:06:32</ReceiptDateTime><TillID>0</TillID><RetailTransaction TransactionStatus="Voided"><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Voided"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Sale"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
Then table TXL_SALES_VOIDED will have 1 row(s)
Then the TXL_SALES_VOIDED database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|TxType|
|0031         |4567         |4209          |2014-04-07     |Void  |

!-- Do a return transaction with transaction 4209
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0075</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>4209</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK

Scenario: Journalize Return Transaction (5-digit Transaction Number)
Given a Journalization Resource
Given a RESTransaction DBInitiator
Given TXL_SALES_JOURNAL is empty
Given TXL_SALES_VOIDED is empty
Given returned transaction 0074 is inserted
When executing journal log with xml <?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>12345</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog> and trainingmode 0
Then result should be OK
Then txid should be 12345
Then status should be OK
Then the TXL_SALES_JOURNAL database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|SystemDateTime       |TxType|ServerId|Tx
|0031         |4567         |74            |2014-04-07     |2014-04-07 16:05:42.0|Sale  |A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:05:42</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax></Sale></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Sale TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="PriceOverride"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0005</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax></Sale></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="CreditDebit" TypeCode="Sale"><Amount>1548</Amount><Tax><Amount>114</Amount></Tax><Voucher><VoucherID>12345</VoucherID></Voucher><Authorization SignatureRequiredFlag="false"><AuthorizationCode>004444</AuthorizationCode><RequestingTerminalID>4969380800020</RequestingTerminalID><AuthorizationDateTime>13/12/10 11:12:04</AuthorizationDateTime><ReferenceNumber>131210-00010001-12345-03200</ReferenceNumber></Authorization><CreditDebit CardType="Credit"><CardIssuerID>012</CardIssuerID><IssueSequence>496938080002012345</IssueSequence><IssuerName>NCR CARD</IssuerName><AccountNumber>xxxxxxxxxxxx4321</AccountNumber><PaymentMethod PaymentMethodCode="0" PaymentMethodName="??"><Ndivided>1</Ndivided></PaymentMethod></CreditDebit></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
|0031         |4567         |12345         |2014-04-07     |2014-04-07 16:08:00.0|Return|A010    |<?xml version="1.0" encoding="UTF-8" ?><POSLog><Transaction><TransactionType>Return</TransactionType><OrganizationHierarchy Level="Š”Ž®‰ïŽÐ" ID="01" /><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>12345</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:08:00</BeginDateTime><OperatorID>111</OperatorID><ReceiptDateTime>2014-04-07T16:08:02</ReceiptDateTime><TillID>0</TillID><RetailTransaction><PriceDerivationResult MethodCode="Promotion"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">101</Amount><PreviousPrice>1101</PreviousPrice><PriceDerivationRule><PriceDerivationRuleID>0002</PriceDerivationRuleID><Description>Type2</Description><ReasonCode>0002</ReasonCode></PriceDerivationRule></PriceDerivationResult><Customer><CustomerDemographic>02</CustomerDemographic></Customer><TransactionLink ReasonCode="Return"><RetailStoreID>0031</RetailStoreID><WorkstationID>4567</WorkstationID><SequenceNumber>0074</SequenceNumber><BusinessDayDate>2014-04-07</BusinessDayDate><BeginDateTime>2014-04-07T16:05:42</BeginDateTime></TransactionLink><ItemCount>6</ItemCount><LineItem><SequenceNumber>1</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000050</ItemID><Description>Item B5</Description><RegularSalesUnitPrice>556</RegularSalesUnitPrice><ActualSalesUnitPrice>556</ActualSalesUnitPrice><ExtendedAmount>556</ExtendedAmount><ExtendedDiscountAmount>101</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">51</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">422</TaxableAmount></Tax><Tax TaxType="Sales" NormalTaxType="Exceptional"><Amount>1</Amount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>2</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000040</ItemID><Description>Item B4</Description><RegularSalesUnitPrice>545</RegularSalesUnitPrice><ActualSalesUnitPrice>545</ActualSalesUnitPrice><ExtendedAmount>545</ExtendedAmount><ExtendedDiscountAmount>99</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Amount Action="Subtract">50</Amount><PriceDerivationRule ApplicationType="MixMatch"><PriceDerivationRuleID>0002</PriceDerivationRuleID><MMQuantity>1</MMQuantity><ReasonCode>0002</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">49</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>33</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">413</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>3</SequenceNumber><Return TaxableFlag="True" Department="9999" Line="0" Class="0"><ItemID Type="Code128">0000000000400</ItemID><Description>Item C4</Description><RegularSalesUnitPrice>1440</RegularSalesUnitPrice><ActualSalesUnitPrice>1440</ActualSalesUnitPrice><ExtendedAmount>1440</ExtendedAmount><ExtendedDiscountAmount>793</ExtendedDiscountAmount><ItemSellingRule /><Quantity>1</Quantity><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>1</SequenceNumber><Percent Action="Subtract">50</Percent><Amount Action="Subtract">720</Amount><PriceDerivationRule ApplicationType="Item"><PriceDerivationRuleID>0001</PriceDerivationRuleID><ReasonCode>01</ReasonCode></PriceDerivationRule></RetailPriceModifier><RetailPriceModifier MethodCode="Markdown"><SequenceNumber>2</SequenceNumber><Percent Action="Subtract">10</Percent><Amount Action="Subtract">73</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule></RetailPriceModifier><Tax TaxType="Sales"><Amount>47</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">600</TaxableAmount></Tax><Disposal Method="Undecided" /><Note>Return Note</Note></Return></LineItem><LineItem><SequenceNumber>4</SequenceNumber><Discount><Percentage>10</Percentage><Amount>172</Amount><PriceDerivationRule ApplicationType="Total"><PriceDerivationRuleID>0002</PriceDerivationRuleID><ReasonCode>02</ReasonCode></PriceDerivationRule><Note>Discount Note</Note></Discount></LineItem><LineItem><SequenceNumber>5</SequenceNumber><Tender TenderType="Cash" TypeCode="Refund"><Amount>2000</Amount><TenderChange><Amount>452</Amount></TenderChange><Note>Tender Note</Note></Tender></LineItem><LineItem><SequenceNumber>6</SequenceNumber><Tax TaxType="Sales"><Amount>114</Amount><Percent>8</Percent><TaxableAmount TaxIncludedInTaxableAmountFlag="false">1434</TaxableAmount><Note>Tax Note</Note></Tax></LineItem><Total TotalType="TransactionSubtotal">1720</Total><Total TotalType="TransactionGrandAmount">1548</Total></RetailTransaction></Transaction></POSLog>
Then the TXL_SALES_VOIDED database table should have the following row(s):
|RetailStoreId|WorkstationId|SequenceNumber|BusinessDayDate|TxType|
|0031         |4567         |74            |2014-04-07     |Return|
